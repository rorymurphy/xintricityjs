/*
Copyright (c) 2013, Rory Murphy
All rights reserved.

Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
Neither the name of the Rory Murphy nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR
CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/(function(k,b){"function"===typeof define&&define.amd?define("XUtil",["jQuery","_"],function(e,h){return k.XUtil=b(e,h,k)}):k.$x=k.XUtil=b(k.jQuery,k._,k)})(this,function(k,b,e){var h;"undefined"!==typeof l&&(h=l);var l={noConflict:function(){h?e.$x=h:delete e.$x},namespace:function(b){b=b.split(".");var h;k.each(b,function(b,k){0==b&&(h=e);k in h||(h[k]={});h=h[k]});return h},format:function(b){var e=arguments;return b=b.replace(/\{(\d+)\}/ig,function(b,h,f,a){return e[parseInt(h)+1]})}},n=/\/[^w_]+\//;
l.slugify=function(b){return b.replace(n,"-").toLowerCase()};l.extend=function(e){b.each(Array.prototype.slice.call(arguments,1),function(b){if(b)for(var h in b){var k=b.__lookupGetter__(h),f=b.__lookupSetter__(h);k||f?(k&&e.__defineGetter__(h,k),f&&e.__defineSetter__(h,f)):e[h]=b[h]}});return e};l.extendClass=function(e,h){var k=this,n;n=e&&b.has(e,"constructor")?e.constructor:function(){return k.apply(this,arguments)};l.extend(n,k,h);var f=function(){this.constructor=n};f.prototype=k.prototype;
n.prototype=new f;e&&l.extend(n.prototype,e);n.__super__=k.prototype;return n};return l});
(function(){var k=[].slice,b;b="undefined"!==typeof exports?exports:this.__XBase__={};b.VERSION="1.1.0";var e=this._;e||"undefined"===typeof require||(e=require("underscore"));var h=this.$x;h||"undefined"===typeof require||(h=require("XUtil"));var l=this.XMVVM;l||"undefined"===typeof require||(l=require("XMVVM"));b.$=this.jQuery||this.Zepto||this.ender||this.$;b.emulateHTTP=!1;b.emulateJSON=!1;var l=h.extendClass,n=function(){throw Error('A "url" property or function must be specified');},u=function(a,
r){var b=r.error;r.error=function(c){b&&b(a,c,r);a.trigger("error",a,c,r)}},v=0;b.Event=function(a){this.eid="e"+v;v++;var r=!1;this.preventDefault=function(){r=!0};this.isDefaultPrevented=function(){return r};var b=!1;this.bubble=function(){b=!0};this.isBubbled=function(){return b};h.extend(this,a)};b.Event.extend=h.extendClass;var p=b.Events={on:function(a,r,b,c){if(!f(this,"on",a,[r,b])||!r)return this;this._events||(this._events={});(this._events[a]||(this._events[a]=[])).push({callback:r,context:b,
bubbled:c,ctx:b||this});return this},once:function(a,r,b,c){if(!f(this,"once",a,[r,b])||!r)return this;var d=this,g=e.once(function(){d.off(a,g,b,c);r.apply(this,arguments)});g._callback=r;return this.on(a,g,b,c)},off:function(a,b,c,d){var g,q,h,m,k,l,s,n;if(!this._events||!f(this,"off",a,[b,c]))return this;if(!(a||b||c||d))return this._events={},this;m=a?[a]:e.keys(this._events);k=0;for(l=m.length;k<l;k++)if(a=m[k],h=this._events[a]){this._events[a]=g=[];if(b||c||d)for(s=0,n=h.length;s<n;s++)q=h[s],
(b&&b!==q.callback&&b!==q.callback._callback||c&&c!==q.context||d&&d!==q.bubbled)&&g.push(q);g.length||delete this._events[a]}return this},trigger:function(E){if(!this._events)return this;var r=k.call(arguments,1);if(!f(this,"trigger",E,r))return this;var c=this._events[E];r[0]instanceof b.Event&&r[0].isBubbled()&&(c=e.filter(c,function(a){return a.bubbled}));var d=this._events.all;c&&a(c,r);d&&a(d,arguments);return this},stopListening:function(a,b,c){var d=this._listeningTo;if(!d)return this;var g=
!b&&!c;c||"object"!==typeof b||(c=this);a&&((d={})[a._listenId]=a);for(var f in d)a=d[f],a.off(b,c,this),(g||e.isEmpty(a._events))&&delete this._listeningTo[f];return this}},z=/\s+/,f=function(a,b,c,d){if(!c)return!0;if("object"===typeof c){for(var g in c)a[b].apply(a,[g,c[g]].concat(d));return!1}if(z.test(c)){c=c.split(z);g=0;for(var f=c.length;g<f;g++)a[b].apply(a,[c[g]].concat(d));return!1}return!0},a=function(a,b){var c,d=-1,g=a.length,f=b[0],e=b[1],q=b[2];switch(b.length){case 0:for(;++d<g;)(c=
a[d]).callback.call(c.ctx);break;case 1:for(;++d<g;)(c=a[d]).callback.call(c.ctx,f);break;case 2:for(;++d<g;)(c=a[d]).callback.call(c.ctx,f,e);break;case 3:for(;++d<g;)(c=a[d]).callback.call(c.ctx,f,e,q);break;default:for(;++d<g;)(c=a[d]).callback.apply(c.ctx,b)}};e.each({listenTo:"on",listenToOnce:"once"},function(a,b){p[b]=function(b,c,d){var r=this._listeningTo||(this._listeningTo={}),g=b._listenId||(b._listenId=e.uniqueId("l"));r[g]=b;d||"object"!==typeof c||(d=this);b[a](c,d,this);return this}});
p.bind=p.on;p.unbind=p.off;e.extend(b,p);var c=b.Model=function(a,b){var c=a||{};b||(b={});this.cid=e.uniqueId("c");this.attributes={};b.collection&&(this.collection=b.collection);b.parse&&(c=this.parse(c,b)||{});c=e.defaults({},c,e.result(this,"defaults"));this.set(c,b);this.changed={};this.initialize.apply(this,arguments)};e.extend(c.prototype,p,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(a){return e.clone(this.attributes)},sync:function(){return b.sync.apply(this,
arguments)},get:function(a){return this.attributes[a]},escape:function(a){return e.escape(this.get(a))},has:function(a){return null!=this.get(a)},set:function(a,b,c){var d,g,f,q,h,m,k;if(null==a)return this;"object"===typeof a?(g=a,c=b):(g={})[a]=b;c||(c={});if(!this._validate(g,c))return!1;f=c.unset;q=c.silent;a=[];h=this._changing;this._changing=!0;h||(this._previousAttributes=e.clone(this.attributes),this.changed={});k=this.attributes;m=this._previousAttributes;this.idAttribute in g&&(this.id=
g[this.idAttribute]);for(d in g)b=g[d],e.isEqual(k[d],b)||a.push(d),e.isEqual(m[d],b)?delete this.changed[d]:this.changed[d]=b,f?delete k[d]:k[d]=b;if(!q)for(a.length&&(this._pending=!0),b=0,d=a.length;b<d;b++)this.trigger("change:"+a[b],this,k[a[b]],c);if(h)return this;if(!q)for(;this._pending;)this._pending=!1,this.trigger("change",this,c);this._changing=this._pending=!1;return this},unset:function(a,b){return this.set(a,void 0,e.extend({},b,{unset:!0}))},clear:function(a){var b={},c;for(c in this.attributes)b[c]=
void 0;return this.set(b,e.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!e.isEmpty(this.changed):e.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?e.clone(this.changed):!1;var b,c=!1,d=this._changing?this._previousAttributes:this.attributes,g;for(g in a)e.isEqual(d[g],b=a[g])||((c||(c={}))[g]=b);return c},previous:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return e.clone(this._previousAttributes)},
fetch:function(a){a=a?e.clone(a):{};void 0===a.parse&&(a.parse=!0);var b=this,c=a.success;a.success=function(d){if(!b.set(b.parse(d,a),a))return!1;c&&c(b,d,a);b.trigger("sync",b,d,a)};u(this,a);return this.sync("read",this,a)},save:function(a,b,c){var d,g=this.attributes;null==a||"object"===typeof a?(d=a,c=b):(d={})[a]=b;c=e.extend({validate:!0},c);if(d&&!c.wait){if(!this.set(d,c))return!1}else if(!this._validate(d,c))return!1;d&&c.wait&&(this.attributes=e.extend({},g,d));void 0===c.parse&&(c.parse=
!0);var f=this,q=c.success;c.success=function(a){f.attributes=g;var b=f.parse(a,c);c.wait&&(b=e.extend(d||{},b));if(e.isObject(b)&&!f.set(b,c))return!1;q&&q(f,a,c);f.trigger("sync",f,a,c)};u(this,c);a=this.isNew()?"create":c.patch?"patch":"update";"patch"===a&&(c.attrs=d);a=this.sync(a,this,c);d&&c.wait&&(this.attributes=g);return a},destroy:function(a){a=a?e.clone(a):{};var b=this,c=a.success,d=function(){b.trigger("destroy",b,b.collection,a)};a.success=function(g){(a.wait||b.isNew())&&d();c&&c(b,
g,a);b.isNew()||b.trigger("sync",b,g,a)};if(this.isNew())return a.success(),!1;u(this,a);var g=this.sync("delete",this,a);a.wait||d();return g},url:function(){var a=e.result(this,"urlRoot")||e.result(this.collection,"url")||n();return this.isNew()?a:a+("/"===a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(a){return this._validate({},e.extend(a||
{},{validate:!0}))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=e.extend({},this.attributes,a);var c=this.validationError=this.validate(a,b)||null;if(!c)return!0;this.trigger("invalid",this,c,e.extend(b,{validationError:c}));return!1}});e.each("keys values pairs invert pick omit".split(" "),function(a){c.prototype[a]=function(){var b=k.call(arguments);b.unshift(this.attributes);return e[a].apply(e,b)}});var d=b.Collection=function(a,b){b||(b={});b.model&&(this.model=b.model);
void 0!==b.comparator&&(this.comparator=b.comparator);this._reset();this.initialize.apply(this,arguments);a&&this.reset(a,e.extend({silent:!0},b))},g={add:!0,remove:!0,merge:!0},q={add:!0,remove:!1};e.extend(d.prototype,p,{model:c,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return b.sync.apply(this,arguments)},add:function(a,b){return this.set(a,e.extend({merge:!1},b,q))},remove:function(a,b){var c=!e.isArray(a);a=c?[a]:e.clone(a);b||
(b={});var d,g,f,q;d=0;for(g=a.length;d<g;d++)if(q=a[d]=this.get(a[d]))delete this._byId[q.id],delete this._byId[q.cid],f=this.indexOf(q),this.models.splice(f,1),this.length--,b.silent||(b.index=f,this.trigger("remove",q,this,b)),this._removeReference(q);return c?a[0]:a},set:function(a,b){b=e.defaults({},b,g);b.parse&&(a=this.parse(a,b));var d=!e.isArray(a);a=d?a?[a]:[]:e.clone(a);var f,q,h,m,k,l,s=b.at,n=this.model,A=this.comparator&&null==s&&!1!==b.sort,C=e.isString(this.comparator)?this.comparator:
null,w=[],u=[],p={},B=b.add,x=b.merge,v=b.remove,y=!A&&B&&v?[]:!1;f=0;for(q=a.length;f<q;f++){k=a[f];h=k instanceof c?m=k:k[n.prototype.idAttribute];if(h=this.get(h))v&&(p[h.cid]=!0),x&&(k=k===m?m.attributes:k,b.parse&&(k=h.parse(k,b)),h.set(k,b),A&&!l&&h.hasChanged(C)&&(l=!0)),a[f]=h;else if(B){m=a[f]=this._prepareModel(k,b);if(!m)continue;w.push(m);m.on("all",this._onModelEvent,this);this._byId[m.cid]=m;null!=m.id&&(this._byId[m.id]=m)}y&&y.push(h||m)}if(v){f=0;for(q=this.length;f<q;++f)p[(m=this.models[f]).cid]||
u.push(m);u.length&&this.remove(u,b)}if(w.length||y&&y.length)if(A&&(l=!0),this.length+=w.length,null!=s)for(f=0,q=w.length;f<q;f++)this.models.splice(s+f,0,w[f]);else for(y&&(this.models.length=0),m=y||w,f=0,q=m.length;f<q;f++)this.models.push(m[f]);l&&this.sort({silent:!0});if(!b.silent){f=0;for(q=w.length;f<q;f++)m=w[f],this.trigger("add",m,this,b);(l||y&&y.length)&&this.trigger("sort",this,b)}return d?a[0]:a},reset:function(a,b){b||(b={});for(var c=0,d=this.models.length;c<d;c++)this._removeReference(this.models[c]);
b.previousModels=this.models;this._reset();a=this.add(a,e.extend({silent:!0},b));b.silent||this.trigger("reset",this,b);return a},push:function(a,b){return this.add(a,e.extend({at:this.length},b))},pop:function(a){var b=this.at(this.length-1);this.remove(b,a);return b},unshift:function(a,b){return this.add(a,e.extend({at:0},b))},shift:function(a){var b=this.at(0);this.remove(b,a);return b},slice:function(){return k.apply(this.models,arguments)},get:function(a){return null==a?void 0:this._byId[a.id]||
this._byId[a.cid]||this._byId[a]},at:function(a){return this.models[a]},where:function(a,b){return e.isEmpty(a)?b?void 0:[]:this[b?"find":"filter"](function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw Error("Cannot sort a set without a comparator");a||(a={});e.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(e.bind(this.comparator,
this));a.silent||this.trigger("sort",this,a);return this},pluck:function(a){return e.invoke(this.models,"get",a)},fetch:function(a){a=a?e.clone(a):{};void 0===a.parse&&(a.parse=!0);var b=a.success,c=this;a.success=function(d){c[a.reset?"reset":"set"](d,a);b&&b(c,d,a);c.trigger("sync",c,d,a)};u(this,a);return this.sync("read",this,a)},create:function(a,b){b=b?e.clone(b):{};if(!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var c=this,d=b.success;b.success=function(a,b,g){g.wait&&c.add(a,
g);d&&d(a,b,g)};a.save(null,b);return a},parse:function(a,b){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(a,b){if(a instanceof c)return a.collection||(a.collection=this),a;b=b?e.clone(b):{};b.collection=this;var d=new this.model(a,b);if(!d.validationError)return d;this.trigger("invalid",this,d.validationError,b);return!1},_removeReference:function(a){this===a.collection&&delete a.collection;
a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){if("add"!==a&&"remove"!==a||c===this)"destroy"===a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments)}});e.each("forEach each map collect reduce foldl inject reduceRight foldr find detect filter select reject every all some any include contains invoke max min toArray size first head take initial rest tail drop last without difference indexOf shuffle lastIndexOf isEmpty chain".split(" "),
function(a){d.prototype[a]=function(){var b=k.call(arguments);b.unshift(this.models);return e[a].apply(e,b)}});e.each(["groupBy","countBy","sortBy"],function(a){d.prototype[a]=function(b,c){var d=e.isFunction(b)?b:function(a){return a.get(b)};return e[a](this.models,d,c)}});b.sync=function(a,c,d){var g=A[a];e.defaults(d||(d={}),{emulateHTTP:b.emulateHTTP,emulateJSON:b.emulateJSON});var f={type:g,dataType:"json"};d.url||(f.url=e.result(c,"url")||n());null!=d.data||!c||"create"!==a&&"update"!==a&&"patch"!==
a||(f.contentType="application/json",f.data=JSON.stringify(d.attrs||c.toJSON(d)));d.emulateJSON&&(f.contentType="application/x-www-form-urlencoded",f.data=f.data?{model:f.data}:{});if(d.emulateHTTP&&("PUT"===g||"DELETE"===g||"PATCH"===g)){f.type="POST";d.emulateJSON&&(f.data._method=g);var q=d.beforeSend;d.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",g);if(q)return q.apply(this,arguments)}}"GET"===f.type||d.emulateJSON||(f.processData=!1);"PATCH"===f.type&&m&&(f.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});
a=d.xhr=b.ajax(e.extend(f,d));c.trigger("request",c,a,d);return a};var m="undefined"!==typeof window&&!!window.ActiveXObject&&!(window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),A={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};b.ajax=function(){return b.$.ajax.apply(b.$,arguments)};var s=b.Router=function(a){a||(a={});a.routes&&(this.routes=a.routes);this._bindRoutes();this.initialize.apply(this,arguments)},C=/\((.*?)\)/g,w=/(\(\?)?:\w+/g,B=/\*\w+/g,D=/[\-{}\[\]+?.,\\\^$|#\s]/g;
e.extend(s.prototype,p,{initialize:function(){},route:function(a,c,d){e.isRegExp(a)||(a=this._routeToRegExp(a));e.isFunction(c)&&(d=c,c="");d||(d=this[c]);var g=this;b.history.route(a,function(f){f=g._extractParameters(a,f);d&&d.apply(g,f);g.trigger.apply(g,["route:"+c].concat(f));g.trigger("route",c,f);b.history.trigger("route",g,c,f)});return this},navigate:function(a,c){b.history.navigate(a,c);return this},_bindRoutes:function(){if(this.routes){this.routes=e.result(this,"routes");for(var a,b=e.keys(this.routes);null!=
(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){a=a.replace(D,"\\$&").replace(C,"(?:$1)?").replace(w,function(a,b){return b?a:"([^/]+)"}).replace(B,"(.*?)");return RegExp("^"+a+"$")},_extractParameters:function(a,b){var c=a.exec(b).slice(1);return e.map(c,function(a){return a?decodeURIComponent(a):null})}});m="undefined"!==typeof window&&!!window.ActiveXObject&&!(window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent);A={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",
read:"GET"};b.ajax=function(){return b.$.ajax.apply(b.$,arguments)};var x=b.History=function(){this.handlers=[];e.bindAll(this,"checkUrl");"undefined"!==typeof window&&(this.location=window.location,this.history=window.history)},F=/^[#\/]|\s+$/g,y=/^\/+|\/+$/g,G=/msie [\w.]+/,H=/\/$/,I=/[?#].*$/;x.started=!1;e.extend(x.prototype,p,{interval:50,getHash:function(a){return(a=(a||this).location.href.match(/#(.*)$/))?a[1]:""},getFragment:function(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||
b){a=this.location.pathname;var c=this.root.replace(H,"");a.indexOf(c)||(a=a.slice(c.length))}else a=this.getHash();return a.replace(F,"")},start:function(a){if(x.started)throw Error("Backbone.history has already been started");x.started=!0;this.options=e.extend({root:"/"},this.options,a);this.root=this.options.root;this._wantsHashChange=!1!==this.options.hashChange;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);a=
this.getFragment();var c=document.documentMode,c=G.exec(navigator.userAgent.toLowerCase())&&(!c||7>=c);this.root=("/"+this.root+"/").replace(y,"/");c&&this._wantsHashChange&&(this.iframe=b.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(a));if(this._hasPushState)b.$(window).on("popstate",this.checkUrl);else if(this._wantsHashChange&&"onhashchange"in window&&!c)b.$(window).on("hashchange",this.checkUrl);else this._wantsHashChange&&(this._checkUrlInterval=
setInterval(this.checkUrl,this.interval));this.fragment=a;a=this.location;c=a.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!c)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._hasPushState&&c&&a.hash&&(this.fragment=this.getHash().replace(F,""),this.history.replaceState({},document.title,this.root+this.fragment+a.search))}if(!this.options.silent)return this.loadUrl()},
stop:function(){b.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);x.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){a=this.getFragment();a===this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe)));if(a===this.fragment)return!1;this.iframe&&this.navigate(a);this.loadUrl()},loadUrl:function(a){a=this.fragment=this.getFragment(a);return e.any(this.handlers,function(b){if(b.route.test(a))return b.callback(a),
!0})},navigate:function(a,b){if(!x.started)return!1;b&&!0!==b||(b={trigger:!!b});var c=this.root+(a=this.getFragment(a||""));a=a.replace(I,"");if(this.fragment!==a){this.fragment=a;""===a&&"/"!==c&&(c=c.slice(0,-1));if(this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else if(this._wantsHashChange)this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,
a,b.replace));else return this.location.assign(c);if(b.trigger)return this.loadUrl(a)}},_updateHash:function(a,b,c){c?(c=a.href.replace(/(javascript:|#).*$/,""),a.replace(c+"#"+b)):a.hash="#"+b}});b.history=new x;s=b.Router=function(a){a||(a={});a.routes&&(this.routes=a.routes);this._bindRoutes();this.initialize.apply(this,arguments)};C=/\((.*?)\)/g;w=/(\(\?)?:\w+/g;B=/\*\w+/g;D=/[\-{}\[\]+?.,\\\^$|#\s]/g;e.extend(s.prototype,p,{initialize:function(){},route:function(a,c,d){e.isRegExp(a)||(a=this._routeToRegExp(a));
e.isFunction(c)&&(d=c,c="");d||(d=this[c]);var g=this;b.history.route(a,function(f){f=g._extractParameters(a,f);d&&d.apply(g,f);g.trigger.apply(g,["route:"+c].concat(f));g.trigger("route",c,f);b.history.trigger("route",g,c,f)});return this},navigate:function(a,c){b.history.navigate(a,c);return this},_bindRoutes:function(){if(this.routes){this.routes=e.result(this,"routes");for(var a,b=e.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){a=a.replace(D,"\\$&").replace(C,
"(?:$1)?").replace(w,function(a,b){return b?a:"([^/]+)"}).replace(B,"(.*?)");return RegExp("^"+a+"$")},_extractParameters:function(a,b){var c=a.exec(b).slice(1);return e.map(c,function(a){return a?decodeURIComponent(a):null})}});c.extend=d.extend=s.extend=x.extend=l}).call(this);
(function(k,b){"function"===typeof define&&define.amd?define("XTemplate",["jQuery","underscore","XUtil"],function(e,h,k){return k.template=b(e,h,k)}):$x.template=b(k.jQuery,k._,k.XUtil)})(this,function(k,b,e){e=function(){b.bindAll(this,"initialize","addTemplate")};e.prototype={_templates:{},_templateTypes:{},initialize:function(){},hasTemplate:function(e){var h=b.has(this._templates,e);h||(e=k("#"+e),h=0<e.length&&(void 0!==e.data("xt-template")||e.is('script[type^="text/template"]')));return h},
getTemplate:function(e){h();b.has(this._templates,e)||this.addTemplate(e);return this._templates[e]},addTemplate:function(e,l,v){h();if(void 0===v||null===v){var p=k("#"+e);if(0==p.length)throw"Must specify a name that corresponds to a template element or provide the template text";p.is('script[type^="text/template"]');v=p.html();void 0===l&&(l=p.data("xt-template"),void 0===l&&(p=p.attr("type"),p=/^text\/template-(.+)$/.exec(p),1<p.length&&(l=p[1])))}if(!b.has(this._templateTypes,l))throw"Unrecognized template type";
l=this._templateTypes[l](v);this._templates[e]=l},registerTemplateType:function(b,e){this._templateTypes[b]=e}};var h=function(){b.has(this._templateTypes,"underscore")||this.registerTemplateType("underscore",function(e){return b.template(e)});b.has(this._templateTypes,"mustache")||"undefined"==typeof Mustache||this.registerTemplateType("mustache",function(b){return Mustache.compile(b)});b.has(this._templateTypes,"handlebars")||"undefined"==typeof Handlebars||this.registerTemplateType("handlebars",
function(b){return Handlebars.compile(b)});b.has(this._templateTypes,"xintricity")||"undefined"==typeof XMVVM||this.registerTemplateType("xintricity",function(b){return XMVVM.Template.compile(b)})},l=new e;e=function(b){return l.getTemplate(b)};e.addTemplate=function(){l.addTemplate.apply(l,arguments)};e.registerTemplateTypes=function(){l.registerTemplateType.apply(l,arguments)};h=b.bind(h,l);return e});
(function(k,b){"function"===typeof define&&define.amd?define("XMVVM-Model",["jQuery","underscore","XUtil","XBase"],function(e,h,l,n){return k.XMVVM=b(e,h,l,n)}):k.XMVVM=b($,_,$x,__XBase__)})(this,function(k,b,e,h){var l={};h.Model.isParentTypeOf=function(b){return h.Model.prototype.isPrototypeOf(b.prototype)};h.Collection.isParentTypeOf=function(b){return h.Collection.prototype.isPrototypeOf(b.prototype)};var n=e.extendClass,u=function(f,a){this.fields||(this.fields={});this.fields&&!b.has(this,"fields")&&
(this.fields=e.extend({},this.fields));b.isFunction(a)&&(a={type:a});b.defaults(a,{persist:!0,type:Object});a.name=f;this.fields[f]=a;this[f]=function(){if(1===arguments.length)this.set(f,arguments[0]);else return this.get(f)}};b.mixin({resultBB:function(f,a,c){void 0===c&&(c=!0);var d=f[a];void 0===d&&f instanceof h.Model&&(d=f.get(a));void 0!==d&&c&&b.isFunction(d)&&(d=d());return d},startsWith:function(b,a){return b.substr(0,a.length)===a},endsWith:function(b,a){var c=b.length-a.length;return 0<=
c&&b.substr(c)===a}});l.Event=h.Event;var v=function(f,a){var c=Array.prototype.slice.call(arguments),d,g=a,e=a.indexOf(":"),h=void 0;b.has(f,g)?h=f[g]:0<=e&&(g=g.substr(0,e+1),b.has(f,g)&&(h=f[g]));if(void 0!==h){var k={};b.each(h,function(a,b){k[a]=c[b+2]});d=new l.Event(k)}return d},p=function(b,a,c,d){Array.prototype.slice.call(arguments);var g;g=null;4<arguments.length&&!(arguments[4]instanceof l.Event)?(g=Array.prototype.slice.call(arguments,3),g.unshift(c),g=v.apply(this,g),g=void 0!==g?[d,
g]:Array.prototype.slice.call(arguments,3)):4===arguments.length?(g={},g[a]=this,g=new l.Event(g),g=[d].concat([g])):g=Array.prototype.slice.call(arguments,3);b.prototype.trigger.apply(this,g)};l.Model=h.Model.extend({constructor:function(f,a){var c=this;b.bindAll(this,"createField","set");b.defaults(c,{fields:{}});b.chain(c.fields).keys().each(function(a){c[a]=b.bind(c[a],c)});h.Model.apply(this,[f,a])},fields:{},createField:function(f,a){u.call(this,f,a);this[f]=b.bind(this[f],this)},clone:function(){var f=
new this.constructor(this.attributes);b.chain(f.fields).keys().each(function(a){f[a]=b.bind(f[a],f)});f.fields=e.extend({},this.fields);b.each(f.fields,function(a,b,d){f.constructor.prototype&&f.constructor.prototype.fields&&f.constructor.prototype.fields[b]||f.createField(b,a)});return f},toJSON:function(){var f=this,a=b.clone(f.attributes);b.each(a,function(c,d){if(!b.has(f.fields,d)||f.fields[d].persist)if(c instanceof l.Model||c instanceof l.Collection)a[d]=c.toJSON()});return a},trigger:b.partial(p,
h.Model,"model",{add:["model","collection","options"],remove:["model","collection","options"],destroy:["model","collection","options"],change:["model","options"],"change:":["model","value","options"],request:["model","xhr","options"],sync:["model","resp","options"],error:["model","xhr","options"],invalid:["model","error","options"]}),set:function(f,a,c){var d=this,g,e,m=d.fields;b.isObject(f)?(g=f,c=a):(g={})[f]=a;var k=b.clone(g);b.each(g,function(a,c,g){var f,l;g=a;if(null!==m&&b.has(m,c)&&(f=m[c],
g=d._prepareValue(f,a),l=!0,b.isFunction(f.validate)&&(l=f.validate(a)),!0!==l))throw l;e=d[c];null!==e&&(e instanceof h.Model||e instanceof h.Collection)&&e.off("all",n,this);if(g instanceof h.Model||g instanceof h.Collection){var n=function(a,c){var g=Array.prototype.slice.call(arguments);b.has(c,"model")&&c.model===d||b.has(c,"recipients")&&b.has(c.recipients,d.cid)||(c.bubble(),c.recipients=c.recipients||{},c.recipients[d.cid]=!0,d.trigger.apply(d,g))};(a=d.get(c))&&a.off("all",n,d.cid+c);g.on("all",
n,d.cid+c)}k[c]=g});h.Model.prototype.set.apply(this,[k,c])},_prepareValue:function(f,a){if(void 0===a||null===a)return a;switch(f.type){case "int":"int"!==typeof a&&(a=parseInt(a));break;case Number:b.isNumber(a)||(a=parseFloat(a));break;case Boolean:b.isBoolean(a)||(a=!0==a);break;case String:b.isString(a)||(a+="");break;case Date:a instanceof Date||(b.isNumber(a)?a=new Date(a):b.isString(a)&&(a=Date.parse(a)));break;case Array:if(!(a instanceof Array))throw"Type mismatch";break;default:if(!(a instanceof
f.type))if((f.type===h.Model||h.Model.isParentTypeOf(f.type))&&b.isObject(a)||(f.type===h.Collection||h.Collection.isParentTypeOf(f.type))&&(b.isObject(a)||b.isArray(a)))a=new f.type(a);else if(!(a instanceof f.type))throw"Type mismatch";}return a},parse:function(f){var a={};b.each(this.fields,function(b,d,g){h.Model.isParentTypeOf(b.type)||h.Collection.isParentTypeOf(b.type)?a[b.name]=new b.type(f[b.name],{parse:!0}):a[b.name]=f[b.name]});return a}});l.Model.extend=function(f,a){if(f.fields){var c=
f.fields;delete f.fields}var d=n.call(this,f,a);c&&(f.fields=c);this.prototype.fields&&b.each(this.prototype.fields,function(a,b){u.call(d.prototype,b,a)});b.has(f,"fields")&&b.each(f.fields,function(a,b){u.call(d.prototype,b,a)});return d};l.Model.createField=function(b,a,c){u.call(b,a,c)};l.Model.defaults={useGetSet:!1};l.Collection=h.Collection.extend({unique:function(){var f=array.slice.call(arguments);f.unshift(this.models);return b.unique.apply(b,f)},_onModelEvent:function(b,a,c,d){"add"!==
b&&"remove"!==b||c===this?h.Collection.prototype._onModelEvent.apply(this,arguments):this.trigger.apply(this,arguments)},trigger:b.partial(p,h.Collection,"collection",{add:["model","collection","options"],remove:["model","collection","options"],destroy:["model","collection","options"],reset:["collection","options"],sort:["collection","options"],request:["collection","xhr","options"],sync:["collection","resp","options"],error:["collection","xhr","options"]})});l.ViewModel=l.Model.extend({view:null,
fields:{model:Object},render:function(){this.view&&(this.$el=e.template(this.view)(this.model(),{context:{viewmodel:this}}));return this.$el},dispose:function(){this.$el&&this.view&&e.template(this.view)("destroy",this.$el)}});var z=function(b,a){if(1==arguments.length)return this.get(b);this.set(b,a)};l.Filters=b.extend({},{isFalse:function(b){return!1===b},isNull:b.isNull,isUndefined:b.isUndefined,isObject:b.isObject,isNullOrUndefined:function(b){return void 0===b||null===b},isEmpty:function(b){return void 0===
b||null===b||""===b},isEqualTo0:function(b){return 0===b},isEqualTo1:function(b){return 1===b},isGreaterThan0:function(b){return 0<b},isLessThan0:function(b){0>b}});l.ModelNavMixins={splitModelPath:function(b){return b.match(/\w+(?=\.?)|(?=\[)\w+(?=\])/g)},resolveModelPath:function(b,a,c){return this.resolveModelExpression(b,{path:a},c)},resolveModelExpression:function(f,a,c){var d=a.path;if(3>arguments.length||void 0===c)c={};c=b.defaults(c,{evalVal:!0,applyFilter:!0,allowPartial:!0});var g=[f];
if("undefined"!==typeof d&&null!==d&&""!==d){for(var d=d instanceof Array?d:this.splitModelPath(d),e=0;e<d.length;e++){var m=g[g.length-1];if(null==m&&c.allowPartial)break;else if(null==m){g=void 0;break}m=m instanceof h.Collection?m.at(d[e]):!m[d[e]]&&m instanceof h.Model&&m.has(d[e])?b.bind(z,m,d[e]):e<d.length-1||c.evalVal?b.resultBB(m,d[e]):m[d[e]];if("undefined"===typeof m){c.allowPartial||(g=void 0);break}g.push(m)}d=void 0!==g&&null!==g&&0<g.length?b.last(g):g;c.applyFilter&&(e=this._applyBindExpression(a,
d,f),e!==d&&g.push(e));return g}},resolveModelExpressionValue:function(f,a){var c=this.resolveModelExpression(f,a,{allowPartial:!1});return c=void 0!==c&&b.isArray(c)&&0<c.length?b.last(c):void 0},_applyBindExpression:function(f,a,c){if(b.has(f,"filter")&&b.isString(f.filter)){c=c.clone();c.createField("Filter",Object);c.set("Filter",l.Filters);f=this.resolveModelPath(c,f.filter,{evalVal:!1,allowPartial:!1});if(b.isArray(f))f=b.last(f);else throw"Invalid filter, path does not exist";if(b.isFunction(f))a=
f(a);else throw"Invalid filter, not a function";}else b.has(f,"pattern")&&b.isString(f.pattern)&&(a=e.format(f.Pattern,a));return a},bindModelPath:function(b,a,c,d){this.bindModelExpression(b,{path:a},c,d)},bindModelExpression:function(f,a,c,d){var g=this.splitModelPath(a.path),e=this.resolveModelPath(f,g),m={model:f,expression:a,callback:c},k=function(a){var c=b.indexOf(e,a.model);return 0>c||c==g.length||0!==c&&!b.has(a.model.changed,g[c])?!1:!0};b.has(this,"_bindingCallbacks")||(this._bindingCallbacks=
[]);m.checkCallback=b.bind(function(a,d){var n;n=!1;switch(a){case "change":n=Array.prototype.slice.call(arguments,1,arguments.length);n=k.apply(this,n);break;case "add":case "remove":n=b.indexOf(e,d.collection),n=0<=n&&(n===e.length-1||b.indexOf(e,d.collection)===n+1)}if(n=n&&!((this instanceof h.Model||this instanceof h.Collection)&&b.has(d,"recipients")&&b.has(d.recipients,this.cid))){e=this.resolveModelPath(f,g);d.recipients=b.has(d,"recipients")?d.recipients:{};d.recipients[this.cid]=!0;c.apply(this,
arguments);n=new l.Event;n.oldValue=m.value;var p=this.resolveModelExpression(m.model,m.expression),p=p.length===g.length+1?b.last(e):void 0;n.value=p;m.value=p;c.apply(this,[n])}},this);this._bindingCallbacks.push(m);f.on("all",m.checkCallback,this)},unbindModelPath:function(b,a,c){this.unbindModelExpression(b,{path:a},c)},unbindModelExpression:function(f,a,c){var d=b.find(this._bindingCallbacks,function(d){return d.model===f&&b.isEqual(d.expression,a)&&d.callback===c});f.off("all",d.checkCallback,
this)},setModelPathValue:function(f,a,c,d){d=void 0===d?!0:d;a=b.isArray(a)?a:this.splitModelPath(a);f=this.resolveModelPath(f,a,{evalVal:!1,allowPartial:!1});var g=f.length,e=f[g-1];d&&b.isFunction(e)?e(c):e instanceof h.Collection?f[g-2].update(c):f[g-2][a[g-1]]=c}};l.Router=h.Router.extend({initialize:function(e){var a=this;b.bindAll(this,"canRoute");e=e||{};b.defaults(e,{root:"/",startHistory:!0,pushState:!0});e.startHistory&&h.history.start({pushState:e.pushState,root:e.root});var c=location.protocol+
"//"+location.hostname+(location.port?":"+location.port:"")+e.root;k(document).on("click","a:not([data-bypass])",function(b){var g=k(this).attr("href");g.substr(0,c.length)===c&&"_blank"!==k(this).attr("target")&&"external"!==k(this).attr("rel")&&(g=g.substr(c.length),a.canRoute(g)&&(b.preventDefault(),a.navigate(g,{trigger:!0})))})},canRoute:function(e){var a=this.root+h.history.getFragment(e),a=a.replace(/[?#].*$/,"");return(a=h.history.fragment)?!1:b.any(h.history.handlers,function(b){if(b.route.test(a))return!0})}});
return l});
(function(k,b){"function"===typeof define&&define.amd?define(["jQuery","underscore","XUtil","XMVVM-Model"],function(e,h,l,n){return k.XMVVM=b(e,h,l,n,XBase)}):k.XMVVM=b(k.jQuery,k._,k.XUtil,k.XMVVM)})(this,function(k,b,e,h){h.Binding=function(){};h.Binding.extend=e.extendClass;h.AttributeBinding=h.Binding.extend({constructor:function(a){this.options=e.extend({},a);this.options=b.defaults(this.options,this.defaults);if(null===this.options.model||null===this.options.path||null===this.options.el||null===
this.options.attr)throw"model, path, el, and attr options are required";"value"!==this.options.attr&&(this.options.updateModel=!1);this.$el=k(this.options.el);b.bindAll(this,"value","setModelAttr","modelChanged","bindModel","unbindModel","bindEl","setElProp","elChanged","dispose");this.bindModel();this.bindEl();this.initialize()},initialize:function(){this.options.updateElement&&this.setElProp(this.value());this.options.updateModel&&this.setModelAttr(this.$el.attr(this.options.attr))},defaults:{model:null,
expression:null,el:null,attr:null,updateModel:!0,updateElement:!0},bindModel:function(){this._modelPath=this.resolveModelExpression(this.options.model,this.options.expression,{evalVal:!1,applyFilter:!1,allowPartial:!1});this.bindModelExpression(this.options.model,this.options.expression,this.modelChanged)},unbindModel:function(){this.unbindModelExpression(this.options.model,this.options.expression,this.modelChanged)},value:function(){if("undefined"!==typeof this._modelPath&&0!==this._modelPath.length){var a=
this._modelPath[this._modelPath.length-1];b.isFunction(a)&&(a=a());return this._applyBindExpression(this.options.expression,a,this.options.model)}},setModelAttr:function(a){var c=this._modelPath;if(void 0===c||null===c)throw"Xintricity cannot set model value, expression does not exist: "+this.options.expression.path;var d=c.length,g=this.splitModelPath(this.options.expression.path);if(0<d&&b.isFunction(c[d-1]))c[d-1](a);else c[d-2][b.last(g)]=a},modelChanged:function(a,b,d){this._modelPath=this.resolveModelExpression(this.options.model,
this.options.expression,{evalVal:!1,applyFilter:!1,allowPartial:!1});this.options.updateElement&&"id"!==this.options.attr&&this.setElProp(this.value())},bindEl:function(){if(3==this.options.el.nodeType)throw"Attribute binding cannot be used with text nodes";this.$el.on("change.binding",this.elChanged)},unbindEl:function(){this.$el.off("change.binding",this.elChanged);this._modelPath=null},setElProp:function(a){this.options.updateElement&&("value"===this.options.attr?this.$el.val(a):"data-xt-src"==
this.options.attr&&this.$el.is("img")?this.$el.attr("src",a):this.$el.attr(this.options.attr,a))},elChanged:function(a,b){this.setModelAttr(k(a.target).val())},dispose:function(){this.unbindModel();this.unbindEl()}});e.extend(h.AttributeBinding.prototype,h.ModelNavMixins);h.TextNodeBinding=h.Binding.extend({constructor:function(a){this.options=e.extend({},a);this.options=b.defaults(this.options,this.defaults);if(null===this.options.model||null===this.options.paths||0===this.options.paths.length||
null===this.options.el||null==this.options.pattern)throw"model, path, el, and attr options are required";this.options.el instanceof k&&(this.options.el=this.options.el.get(0));this._modelPaths={};this._callbacks={};b.bindAll(this,"initialize","value","modelChanged","bindModel","updateText","dispose");this.bindModel();this.initialize()},initialize:function(){this.updateText()},defaults:{model:null,paths:null,el:null,pattern:null},bindModel:function(a){var c=this;b.each(1===arguments.length?[a]:this.options.paths,
function(a){c._callbacks[a]=b.bind(c.modelChanged,c,a);c.bindModelExpression(c.options.model,a,c._callbacks[a])})},value:function(a){a=this.resolveModelExpression(this.options.model,a,{evalVal:!0,allowPartial:!1});return b.isArray(a)&&0<a.length?b.last(a):void 0},modelChanged:function(a){this.updateText()},updateText:function(){var a=this,c=[a.options.pattern],d=!1;b.each(a.options.paths,function(g){var e=a.value(g),e=void 0==e?"":e.toString();b.has(g,"html")&&"true"===g.html?(c.push(e),d=!0):(e=
e?a.escapeHtml(e):e,c.push(e))});var g=e.format.apply(this,c).replace(/&#123;/,"{").replace(/&#125;/,"}");if(d){var f=document.createElement("div"),h=k(a.options.el).parent().get(0),l=a.options.el;l instanceof NodeList||(l=[a.options.el]);f.innerHTML="<div>"+g+"</div>";f=f.children;b.each(f,function(a){h.insertBefore(a,l[0])});b.each(l,function(a){h.removeChild(a)});0<k(f).parents("html").length&&k(f).filter("script").each(function(){k.globalEval(this.text||this.textContent||this.innerHTML||"")});
a.options.el=f}else a.options.el.nodeValue=a.escapeEntities(g)},escapeHtml:function(a){return a.replace(/&<>"/g,function(a){return h.TextNodeBinding.HtmlEntities[a]})},escapeEntities:function(a){return a.replace(/[^\x20-\x7E]/g,function(a){return h.TextNodeBinding.EntityCodes[a]?"&"+h.TextNodeBinding.EntityCodes[a]+";":a})},dispose:function(){var a=this;b.each(this.options.paths,function(b){a.unbindModelExpression(a.options.model,b,a._callbacks[b])});delete a._callbacks;delete a._modelPaths}});e.extend(h.TextNodeBinding.prototype,
h.ModelNavMixins);h.TextNodeBinding.HtmlEntities={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};h.TextNodeBinding.EntityCodes={apos:39,quot:34,amp:38,lt:60,gt:62,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,copy:169,ordf:170,laquo:171,not:172,shy:173,reg:174,macr:175,deg:176,plusmn:177,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,sup1:185,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,Agrave:192,Aacute:193,Acirc:194,
Atilde:195,Auml:196,Aring:197,AElig:198,Ccedil:199,Egrave:200,Eacute:201,Ecirc:202,Euml:203,Igrave:204,Iacute:205,Icirc:206,Iuml:207,ETH:208,Ntilde:209,Ograve:210,Oacute:211,Ocirc:212,Otilde:213,Ouml:214,times:215,Oslash:216,Ugrave:217,Uacute:218,Ucirc:219,Uuml:220,Yacute:221,THORN:222,szlig:223,agrave:224,aacute:225,acirc:226,atilde:227,auml:228,aring:229,aelig:230,ccedil:231,egrave:232,eacute:233,ecirc:234,euml:235,igrave:236,iacute:237,icirc:238,iuml:239,eth:240,ntilde:241,ograve:242,oacute:243,
ocirc:244,otilde:245,ouml:246,divide:247,oslash:248,ugrave:249,uacute:250,ucirc:251,uuml:252,yacute:253,thorn:254,yuml:255,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,
kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,
trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,"int":8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,
sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830};h.CssClassBinding=h.Binding.extend({constructor:function(a){this.options=e.extend({},a);this.options=b.defaults(this.options,this.defaults);if(null===this.options.model||null===this.options.path||null===this.options.el||null===this.options.cssClass)throw"model, path, cssClass, and el are required";this.$el=k(this.options.el);b.bindAll(this,"value","modelChanged","bindModel",
"unbindModel","setElClasses","dispose");this.bindModel();this.initialize()},initialize:function(){this.setElClasses(this.value())},defaults:{model:null,expression:null,el:null,attr:null},bindModel:function(){this._modelPath=this.resolveModelExpression(this.options.model,this.options.expression,{evalVal:!1,allowPartial:!1});this.bindModelExpression(this.options.model,this.options.expression,this.modelChanged)},unbindModel:function(){this.unbindModelExpression(this.options.model,this.options.expression,
this.modelChanged)},value:function(){if("undefined"!==typeof this._modelPath&&0!==this._modelPath.length){var a=this._modelPath[this._modelPath.length-1];return b.isFunction(a)?a():a}},modelChanged:function(a,b,d){this._modelPath=this.resolveModelExpression(this.options.model,this.options.expression,{evalVal:!1,allowPartial:!1});this.setElClasses(this.value())},setElClasses:function(a){a?this.$el.addClass(this.options.cssClass,a):this.$el.removeClass(this.options.cssClass,a)},dispose:function(){this.unbindModel()}});
e.extend(h.CssClassBinding.prototype,h.ModelNavMixins);h.SelectBinding=h.Binding.extend({constructor:function(a){this.options=e.extend({},a);this.options=b.defaults(this.options,this.defaults);if(null===this.options.model||null===this.options.path||null===this.options.el)throw"model, path, and el options are required";this.$el=k(this.options.el);b.bindAll(this,"value","bindModel","unbindModel","modelChanged","bindEl","createOptions","dispose");this.bindModel();this.bindEl();this.initialize()},initialize:function(){var a=
this.$el.val();this.createOptions(this.value());this.$el.val()!=a&&this.$el.trigger("change")},defaults:{model:null,path:null,el:null,textField:"name",valueField:"value"},bindModel:function(){this._modelPath=this.resolveModelPath(this.options.model,this.options.path,{evalVal:!1,allowPartial:!1});this.bindModelPath(this.options.model,this.options.path,this.modelChanged)},unbindModel:function(){var a=this;b.each(a._bindingCallbacks,function(b,d){a.unbindModelPath(b.model,b.path,b.callback)});this._bindingCallbacks=
[]},value:function(){if("undefined"!==typeof this._modelPath&&0!==this._modelPath.length){var a=this._modelPath[this._modelPath.length-1];return b.isFunction(a)?a():a}},modelChanged:function(a,b,d){this._modelPath=this.resolveModelPath(this.options.model,this.options.path,{evalVal:!1,allowPartial:!1});this.createOptions(this.value())},bindEl:function(){if(!this.options.el.is("select"))throw"el must be of node type <select>";k(this.options.el)},unbindEl:function(){k(t.options.el).off("change.binding",
t.elChanged);this._modelPath=null},createOptions:function(a){var c=this,d=k(c.options.el),g=d.val();d.empty();var e=function(a,g,e){g=b.resultBB(a,c.options.textField);a=b.resultBB(a,c.options.valueField);e=k(document.createElement("option"));e.text(g).val(a);d.append(e)};a instanceof h.Collection?a.each(e):b.each(a,e);d.val(g)},dispose:function(){this.unbindModel();this.unbindEl()}});e.extend(h.SelectBinding.prototype,h.ModelNavMixins);h.Trigger=function(a){if(null===arguments||0===arguments.length)a=
{};this.options=b.defaults(a,this.defaults);this.initialize.apply(this)};e.extend(h.Trigger.prototype,{defaults:{el:null,event:"click"},initialize:function(){b.bindAll(this,"onTrigger","onTriggerInv","onTriggerInternal","onTriggerInvInternal","bind","unbind","dispose");this.bind()},onTrigger:function(a){},onTriggerInv:function(a){},onTriggerInternal:function(a){var b=new h.Event({event:this.options.event,target:a.target});this.onTrigger(b);b.isDefaultPrevented()&&a.preventDefault()},onTriggerInvInternal:function(a){var b=
new h.Event({event:this.options.event});this.onTrigger(b);b.isDefaultPrevented()&&a.preventDefault()},bind:function(){var a=k(this.options.el);switch(this.options.event){case null:throw"Event name cannot be null";case "hover":a.on("mouseenter.binding",this.onTriggerInternal);a.on("mouseleave.binding",this.onTriggerInvInternal);break;default:a.on(this.options.event+".binding",this.onTriggerInternal)}},unbind:function(){var a=k(this.options.el);switch(this.options.event){case null:throw"Event name cannot be null";
case "hover":a.off("mouseenter.binding",this.onTriggerInternal);a.on("mouseleave.binding",this.onTriggerInvInternal);break;default:a.off(this.options.event+".binding",this.onTriggerInternal)}},dispose:function(){this.unbind()}});h.Trigger.extend=e.extendClass;h.StyleTrigger=h.Trigger.extend({initialize:function(){h.Trigger.prototype.initialize.call(this)},defaults:{el:null,event:"click",target:null},onTrigger:function(){var a=this,c=k(a.options.el),d=c;null!=a.options.target&&(d=a.getTarget(c));null!=
a.options.cssClass&&(a.options.cssClass instanceof Array?b.each(a.options.cssClass,function(a,b,c){d.addClass(a)}):d.addClass(a.options.cssClass));null!=a.options.styles&&(a.prevStyles={},b.each(a.options.styles,function(b,c,e){a.prevStyles[c]=d.css(c);d.css(c,b)}))},onTriggerInv:function(){var a=$el;null!=t.options.target&&(a=t.getTarget($el));null!=this.options.cssClass&&(this.options.cssClass instanceof Array?b.each(this.options.cssClass,function(b,d,g){a.removeClass(b)}):a.removeClass(this.options.cssClass));
null!=this.options.styles&&(this.prevStyles={},b.each(this.options.styles,function(b,d,g){a.css(d,this.prevStyles[d])}))},getTarget:function(a){return a}});e.extend(h.StyleTrigger.prototype,h.ModelNavMixins);h.Actions=b.extend({},{});h.ActionTrigger=h.Trigger.extend({defaults:{el:null,event:"click",context:{},action:null,data:void 0},initialize:function(){h.Trigger.prototype.initialize.call(this)},onTrigger:function(a){if(null!=this.options.context&&null!=this.options.action){var c=this.resolveModelExpression(this.options.context,
this.options.action,{evalVal:!1});b.isArray(c)&&(c=b.last(c));var d=this.options.data;void 0!==this.options.data&&b.has(d,"path")&&(a.data=this.resolveModelExpressionValue(this.options.context,d));c(a)}}});e.extend(h.ActionTrigger.prototype,h.ModelNavMixins);var l=function(a){var c=this;c.options=e.extend({},a);0<arguments.length&&b.defaults(c.options,c.defaults);c._bindings=[];c._triggers=[];c._logicBlocks=[];c._nestedTemplates=[];c.excludeNestedScopes=function(a){return 0<k(this).parentsUntil(c.$el,
l.childScopeSelector).length};c.options.el&&(c.options.el instanceof k&&(c.options.el=c.options.el.get(0)),c.el=c.options.el,c.$el=k(c.el));c.initialize();c.options.el&&b.isString(c.options.type)&&c.parse()};l.childScopeSelector="[data-xt-foreach],[data-xt-if],[data-xt-elseif],[data-xt-else]";l.attributeBindingPattern=/^\{\{[a-zA-Z][\w\._]*\}\}$/;l.textBindingPattern=/\{\{([a-zA-Z][\w\._]*|([a-zA-z]\w*\s*=\s*('[^']*'|"[^"]*"),?\s*)+)\}\}/g;l.extend=e.extendClass;e.extend(l.prototype,{defaults:{el:null,
type:"template"},initialize:function(){},parse:function(){var a=this;a.parseTriggers();a.parseForeaches();a.parseIfs();a.parseTemplates();a.parseSelectBindings();a.$el.find("*").not(l.childScopeSelector).not(a.excludeNestedScopes).add(a.$el).each(function(b,d){a.parseAttributeBindings(d);a.parseCssClassBindings(d);a.parseTextBindings(d)})},parseTriggers:function(){var a=this;a.$el.find("[data-xt-event]").not(a.excludeNestedScopes).each(function(c,d){var g=k(d),e=g.parent(),e={el:e,position:a.calculatePosition(e,
a.$el)},f=g.data("xt-action"),n=g.data("xt-data"),s=g.data("xt-style"),p=g.data("xt-class");if(f)e.type=h.ActionTrigger,e.action=a.parseBinding(f,!1),void 0!==n&&(e.data=a.parseBinding(n,!1)),e.event=g.data("xt-event");else if(null!=s||null!=p)e.type=h.StyleTrigger,e.styles={},null!=s&&(s=g.data("xt-style").split(";"),b.each(e.styles,function(a){a=a.split(":");option.styles[a[0].trim()]=a[1].trim()})),null!=p&&(e.cssClass=p);g.remove();a._triggers.push(new l(e))})},parseForeaches:function(){var a=
this;a.$el.find("[data-xt-foreach]").not(a.excludeNestedScopes).each(function(b,d){var g=k(d),e=new l({el:d,type:"foreach",position:a.calculatePosition(g,a.$el),expression:a.parseBinding(g.data("xt-foreach")),iterator:g.data("xt-iterator"),indexer:g.data("xt-index")});g.is("[data-xt-onrender]")&&(e.options.onrender=a.parseBinding(g.data("xt-onrender")));a._logicBlocks.push(e)})},parseIfs:function(){var a=this;a.$el.find("[data-xt-if]").not(a.excludeNestedScopes).each(function(b,d){var g=k(d),e=g.next(),
f=new l({el:d,type:"if",position:a.calculatePosition(g,a.$el),branches:[],defaultBranch:null}),h=new l({el:g,type:"branch",expression:a.parseBinding(g.data("xt-if"))});g.is("[data-xt-onrender]")&&(h.options.onrender=a.parseBinding(g.data("xt-onrender")));for(f.options.branches.push(h);e.is("[data-xt-elseif]");)h=new l({el:e,type:"branch",expression:a.parseBinding(g.data("xt-elseif"))}),e.is("[data-xt-onrender]")&&(h.options.onrender=a.parseBinding(e.data("xt-onrender"))),f.options.branches.push(h),
e=e.next();e.is("[data-xt-else]")&&(f.options.defaultBranch=new l({el:e,type:"else"}),e.is("[data-xt-onrender]")&&(f.options.defaultBranch.options.onrender=a.parseBinding(e.data("xt-onrender"))));a._logicBlocks.push(f)})},parseTemplates:function(){var a=this;a.$el.find("[data-xt-partial]").not(a.excludeNestedScopes).each(function(c,d){var e=k(d),f=e.data("xt-model");f&&(f=a.parseBinding(f));var h=e.data("xt-partial");if(void 0===f){var n=a.parseBinding(h);b.isObject(n)&&(f=n,h=void 0)}a._nestedTemplates.push(new l({el:d,
type:"templateref",position:a.calculatePosition(e,a.$el),template:h,model:f}))})},parseAttributeBindings:function(a){var c=k(a),d=this;b.each(a.attributes,function(a){var e=a.name;"data-xt-"===e.substr(0,8)&&"data-xt-src"!==e||"type"===e||(a=a.value,a=d.parseBinding(a),b.isObject(a)&&d._bindings.push({expression:a,type:h.AttributeBinding,position:d.calculatePosition(c,d.$el),attr:e}))})},parseCssClassBindings:function(a){var c=k(a),d=this;a=b.filter(a.attributes,function(a){return b.startsWith(a.name,
"data-xt-class-")});b.each(a,function(a){var e=a.name;a=a.value;a=d.parseBinding(a);b.isObject(a)&&d._bindings.push({expression:a,type:h.CssClassBinding,position:d.calculatePosition(c,d.$el),cssClass:e.substr(14)})})},parseTextBindings:function(a){var c=this;a=k(a).contents();b.each(a.filter(function(){return 3==this.nodeType}),function(a){for(var e=[],f=null;f=l.textBindingPattern.exec(a.nodeValue);)e.push(f[0]);if(null!=e&&0<e.length){var m=b.uniq(e),e=b.map(m,function(a){return c.parseBinding(a)}),
f=a.nodeValue,f=f.replace(/\{/,"&#123;").replace(/\}/,"&#125;"),f=a.nodeValue.replace(l.textBindingPattern,function(a){return"{"+b.indexOf(m,a)+"}"});c._bindings.push({type:h.TextNodeBinding,paths:e,pattern:f,position:c.calculatePosition(k(a),c.$el)})}})},parseSelectBindings:function(a){var b=this,d;b.$el.find("select[data-xt-options]").not(b.excludeNestedScopes).each(function(a,e){var f=k(e);d=f.data("xt-options");var l={el:e,type:h.SelectBinding,path:d.substr(2,d.length-4),position:b.calculatePosition(f,
b.$el)},n=f.data("xt-text-field"),f=f.data("xt-value-field");void 0!==n&&null!==n&&(l.textField=n);void 0!==f&&null!==f&&(l.valueField=f);b._bindings.push(l)})},parseBinding:function(a,b){var d={},e,f=/^\{\{(?:\s*(Path|Filter|Pattern|HTML)\s*=\s*(?:'([^']*)'|"([^"]*)")\s*\,?)+\}\}$/ig,h=/(Path|Filter|Pattern|HTML)\s*=\s*('[^']*'|"[^"]*")\s*/ig;1===arguments.length&&(b=!0);e=a.match(/^\{\{([\w\.\[\]]+)\}\}$/i);if(null!==e&&1<e.length)d.path=e[1];else if(b)if(null!==f.exec(a)){for(;e=h.exec(a);)d[e[1].toLowerCase()]=
e[2].substring(1,e[2].length-1);d.hasOwnProperty("path")||(d=void 0)}else d=a;else d=a;return d},createInstance:function(a){if("template"!==this.options.type)throw"Invalid object type";return new u({block:this})},calculatePosition:function(a,b){if(a===b)return[];a=k(a);b=k(b);var d=a.parentsUntil(b);if(0!==a.closest(b).length){var e=[a.parent().contents().index(a)];d.each(function(a,b){var c=k(b);e.unshift(c.parent().contents().index(c))});return e}}});var n=function(a){this.options=e.extend({},a);
0<arguments.length&&(b.defaults(this.options,this.defaults),a.el&&this.setEl(a.el));this.initialize()};n.extend=e.extendClass;e.extend(n.prototype,{defaults:{block:null,context:null,el:null},initialize:function(){this._bindings=[];this._triggers=[];this._logicBlocks=[];this._nestedTemplates=[];b.bindAll(this,"render")},render:function(){},renderInternal:function(a,c,d){var f=this;a=a?a:this.options.block;var h=k(c);b.each(a._triggers,function(a,b){var c=a.options.type,k=e.extend({},a.options);k.el=
f.resolveElement(h,a.options.position);k.context=d;delete k.type;delete k.position;f._triggers.push(new c(k))});b.each(a._logicBlocks,function(a,b){var c=f.resolveElement(h,a.options.position);switch(a.options.type){case "if":c=new p({block:a,context:d,el:c});break;case "foreach":c=new z({block:a,context:d,el:c});break;default:throw"Unknown logic block";}f._logicBlocks.push(c);c.render()});b.each(a._bindings,function(a,b){var c=f.resolveElement(h,a.position),c=e.extend({},a,{model:d,el:c});delete c.position;
c=new a.type(c);f._bindings.push(c)});b.each(a._nestedTemplates,function(a,b){var c=f.resolveElement(h,a.options.position),c=new v({block:a,context:d,el:c});f._nestedTemplates.push(c);c.render()})},setEl:function(a){this.el=a;this.$el=k(a)},resolveElement:function(a,c){var d=a;b.each(c,function(a){d=d.contents().eq(a)});return d},clear:function(){b.each(this._bindings,function(a){a.dispose()});this._bindings=[];b.each(this._triggers,function(a){a.dispose()});this._triggers=[];b.each(this._logicBlocks,
function(a){a.dispose()});this._logicBlocks=[];b.each(this._nestedTemplates,function(a){a.dispose()});this._nestedTemplates=[];this.$el.empty()},dispose:function(){this.clear()},createContext:function(a,c){var d;d=null!=c?this.options.context.clone():new h.Model;b.each(a,function(a,c,e){d.set(c,a);b.isUndefined(a)||b.isNull(a)||d.createField(c,{type:a.constructor})});return d}});e.extend(n.prototype,h.ModelNavMixins);var u=n.extend({initialize:function(){n.prototype.initialize.apply(this);b.bindAll(this,
"render")},render:function(){var a=this.options.block;this.setEl(k(a.el).clone());var b=this.createContext(this.options.context);this.renderInternal(a,this.$el,b);this.$el.removeClass("xt-template")}}),v=n.extend({initialize:function(){n.prototype.initialize.apply(this);b.bindAll(this,"modelChanged","render");var a=this.options.block.options.model;this.bindModelExpression(this.options.context,a,this.modelChanged);this.model=this.resolveModelExpressionValue(this.options.context,a)},modelChanged:function(){var a=
t.options.block.model;t.unbindModelPath(t.options.context,a,t.modelChanged);t.bindModelExpression(t.options.context,a,t.modelChanged);t.model=t.resolveModelExpressionValue(t.options.context,a)},render:function(){var a=this.options.block;this.clear();a=a.options.template;(b.isUndefined(a)||b.isNull(a))&&this.model instanceof h.ViewModel?a=this.model.render():(b.isObject(a)&&(a=this.resolveModelExpressionValue(this.options.context,a)),e.template(a)("destroy",this.$el),a=e.template(a)(this.model));this.$el.replaceWith(a);
this.setEl(a)},dispose:function(){var a=this.options.block;this.clear();a=a.options.template;(b.isUndefined(a)||b.isNull(a))&&this.model instanceof h.ViewModel&&this.model.dispose()}}),p=n.extend({initialize:function(){var a=this,c=a.options.block;a.current=null;for(var d=a.$el.next();0<d.filter("[data-xt-else-if]").length;)a.$el=a.$el.add(d),d=d.next();0<d.filter("[data-xt-else]").length&&(a.$el=a.$el.add(d));n.prototype.initialize.apply(a);b.bindAll(a,"render");this.branches=[];b.each(c.options.branches,
function(c,d){var e={};e.callback=b.bind(a.modelChanged,a,d);e.value=a.resolveModelExpressionValue(a.options.context,c.options.expression);null===a.current&&e.value&&(a.current=d);a.bindModelExpression(a.options.context,c.options.expression,e.callback);a.branches.push(e)})},modelChanged:function(a){var b=this.options.block,d=this.branches[a],e=d.value;d.value=this.resolveModelExpressionValue(this.options.context,b.options.branches[a].options.expression);if((null===this.current||a<=this.current)&&
d.value!=e){a=null;for(d=0;d<this.branches.length;d++)if(this.branches[d].value){a=d;break}null===a&&null!==b.options.defaultBranch&&(a=this.branches.length);this.current=a;this.render()}},render:function(){var a=this.options.block.options,c=null!==this.current&&this.current<this.branches.length?a.branches[this.current]:a.defaultBranch;this.clear();var d=null;c?(d=k(c.options.el).clone(),d.removeAttr("data-xt-if"),this.renderInternal(c,d,this.options.context)):d=document.createTextNode("");for(var e=
0;e<this.branches.length-1;e++)d=d.add(document.createTextNode(""));null!==a.defaultBranch&&(d=d.add(document.createTextNode("")));this.$el.eq(0).prev().length?d.insertBefore(this.$el.eq(0)):this.$el.eq(0).parent().prepend(d);this.$el.remove();this.setEl(d);c&&b.has(c.options,"onrender")&&(a=this.resolveModelExpression(this.options.context,c.options.onrender),b.isArray(a)&&0<a.length&&(a=b.last(a),a(d)))}}),z=n.extend({initialize:function(){n.prototype.initialize.apply(this);var a=this.options.block.options.expression;
b.bindAll(this,"render","modelChanged");this.bindModelExpression(this.options.context,a,this.modelChanged);this.value=this.resolveModelExpressionValue(this.options.context,a)},modelChanged:function(a){var b=this.options.block.options.expression,d=this.resolveModelExpressionValue(this.options.context,b);a=this.value!=d||"add"===a||"remove"===a;this.value=d;a&&(this.value=this.resolveModelExpressionValue(this.options.context,b),this.render())},render:function(){var a=this,c=a.options.block;a.clear();
if(a.value&&0<a.value.length){var d=c.options.iterator,e=b.has(c.options,"indexer")?c.options.indexer:void 0;c.$el.clone().children();a.$el.removeAttr("data-xt-foreach");a.$el.removeAttr("data-xt-iterator");var f=function(b,f,h){h={};void 0!==e&&(h[e]=f);h[d]=b;b=a.createContext(h,a.options.context);f=k(c.el).clone();a.renderInternal(a.options.block,f,b);a.$el.append(f.children())};a.value instanceof h.Collection?a.value.forEach(f):b.each(a.value,f)}b.has(c.options,"onrender")&&(f=a.resolveModelExpression(a.options.context,
c.options.onrender),b.isArray(f)&&0<f.length&&(f=b.last(f),f($next)))}}),f={};h.Template=function(a,b){this.block=a;this.context=b;this.tmplID=Math.floor(1E8*Math.random());f[this.tmplID]=this};e.extend(h.Template.prototype,{render:function(){var a=new u({block:this.block,context:this.context});a.render();a=a.$el;a.data("template-id",this.tmplID);return a.children()},dispose:function(){}});h.Template.compile=function(){var a;if(2<arguments.length)throw"Invalid arguments";a=arguments[0]instanceof k?
arguments[0]:k(arguments[0]);a=k("<div></div>").append(a);var c=new l({el:a});return 2===arguments.length&&!0===arguments[1]?c:function(a,g,l){if(!b.isString(a)){l=g;var m={model:a};l&&l.context&&e.extend(m,l.context);return(new h.Template(c,m)).render()}a=arguments[0];if(!b.isString(a))throw"Invalid argument (1), String expected";switch(a){case "destroy":if(2!==arguments.length)throw"Invalid number of arguments";m=arguments[1];if(!(m instanceof k))throw"Invalid argument (2), jQuery expected";m.data("template-id")&&
f[m.data("template-id")].dispose()}}};"undefined"!==typeof test&&(h.templateInstances=f);return h});
