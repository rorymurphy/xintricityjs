/*
Copyright (c) 2013, Rory Murphy
All rights reserved.

Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
Neither the name of the Rory Murphy nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR
CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/(function(g,b){"function"===typeof define&&define.amd?define("XUtil",["jQuery","_"],function(d,c){return g.XUtil=b(d,c,g)}):g.$x=g.XUtil=b(g.jQuery,g._,g)})(this,function(g,b,d){var c;"undefined"!==typeof k&&(c=k);var k={noConflict:function(){c?d.$x=c:delete d.$x},namespace:function(b){b=b.split(".");var c;g.each(b,function(b,g){0==b&&(c=d);g in c||(c[g]={});c=c[g]});return c},format:function(b){var c=arguments;return b=b.replace(/\{(\d+)\}/ig,function(b,d,f,l){return c[parseInt(d)+1]})}},m=/\/[^w_]+\//;
k.slugify=function(b){return b.replace(m,"-").toLowerCase()};k.extend=function(c){b.each(Array.prototype.slice.call(arguments,1),function(b){if(b){var d="undefined"!==typeof{}.__lookupGetter__,g;for(g in b){var f,l;d&&(f=b.__lookupGetter__(g),l=b.__lookupSetter__(g));f||l?(f&&c.__defineGetter__(g,f),l&&c.__defineSetter__(g,l)):c[g]=b[g]}}});return c};k.extendClass=function(c,d){var g=this,m;m=c&&b.has(c,"constructor")?c.constructor:function(){return g.apply(this,arguments)};k.extend(m,g,d);var f=
function(){this.constructor=m};f.prototype=g.prototype;m.prototype=new f;c&&k.extend(m.prototype,c);m.__super__=g.prototype;return m};return k});
(function(){var g=[].slice,b;b="undefined"!==typeof exports?exports:this.__XBase__={};b.VERSION="1.1.0";var d=this._;d||"undefined"===typeof require||(d=require("underscore"));var c=this.$x;c||"undefined"===typeof require||(c=require("XUtil"));var k=this.XMVVM;k||"undefined"===typeof require||(k=require("XMVVM"));b.$=this.jQuery||this.Zepto||this.ender||this.$;b.emulateHTTP=!1;b.emulateJSON=!1;var k=c.extendClass,m=function(){throw Error('A "url" property or function must be specified');},z=function(a,
w){var b=w.error;w.error=function(e){b&&b(a,e,w);a.trigger("error",a,e,w)}},x=0;b.Event=function(a){this.eid="e"+x;x++;var w=!1;this.preventDefault=function(){w=!0};this.isDefaultPrevented=function(){return w};var b=!1;this.bubble=function(){b=!0};this.isBubbled=function(){return b};c.extend(this,a)};b.Event.extend=c.extendClass;var p=b.Events={on:function(a,b,e,h){if(!f(this,"on",a,[b,e])||!b)return this;this._events||(this._events={});(this._events[a]||(this._events[a]=[])).push({callback:b,context:e,
bubbled:h,ctx:e||this});return this},once:function(a,b,e,h){if(!f(this,"once",a,[b,e])||!b)return this;var c=this,l=d.once(function(){c.off(a,l,e,h);b.apply(this,arguments)});l._callback=b;return this.on(a,l,e,h)},off:function(a,b,e,h){var c,l,r,g,v,A,B,u;if(!this._events||!f(this,"off",a,[b,e]))return this;if(!(a||b||e||h))return this._events={},this;g=a?[a]:d.keys(this._events);v=0;for(A=g.length;v<A;v++)if(a=g[v],r=this._events[a]){this._events[a]=c=[];if(b||e||h)for(B=0,u=r.length;B<u;B++)l=r[B],
(b&&b!==l.callback&&b!==l.callback._callback||e&&e!==l.context||h&&h!==l.bubbled)&&c.push(l);c.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var w=g.call(arguments,1);if(!f(this,"trigger",a,w))return this;var e=this._events[a];w[0]instanceof b.Event&&w[0].isBubbled()&&(e=d.filter(e,function(a){return a.bubbled}));var h=this._events.all;e&&l(e,w);h&&l(h,arguments);return this},stopListening:function(a,b,e){var h=this._listeningTo;if(!h)return this;var f=
!b&&!e;e||"object"!==typeof b||(e=this);a&&((h={})[a._listenId]=a);for(var c in h)a=h[c],a.off(b,e,this),(f||d.isEmpty(a._events))&&delete this._listeningTo[c];return this}},C=/\s+/,f=function(a,b,e,h){if(!e)return!0;if("object"===typeof e){for(var f in e)a[b].apply(a,[f,e[f]].concat(h));return!1}if(C.test(e)){e=e.split(C);f=0;for(var c=e.length;f<c;f++)a[b].apply(a,[e[f]].concat(h));return!1}return!0},l=function(a,b){var e,h=-1,f=a.length,c=b[0],l=b[1],d=b[2];switch(b.length){case 0:for(;++h<f;)(e=
a[h]).callback.call(e.ctx);break;case 1:for(;++h<f;)(e=a[h]).callback.call(e.ctx,c);break;case 2:for(;++h<f;)(e=a[h]).callback.call(e.ctx,c,l);break;case 3:for(;++h<f;)(e=a[h]).callback.call(e.ctx,c,l,d);break;default:for(;++h<f;)(e=a[h]).callback.apply(e.ctx,b)}};d.each({listenTo:"on",listenToOnce:"once"},function(a,b){p[b]=function(b,e,w){var h=this._listeningTo||(this._listeningTo={}),f=b._listenId||(b._listenId=d.uniqueId("l"));h[f]=b;w||"object"!==typeof e||(w=this);b[a](e,w,this);return this}});
p.bind=p.on;p.unbind=p.off;d.extend(b,p);var v=b.Model=function(a,b){var e=a||{};b||(b={});this.cid=d.uniqueId("c");this.attributes={};b.collection&&(this.collection=b.collection);b.parse&&(e=this.parse(e,b)||{});e=d.defaults({},e,d.result(this,"defaults"));this.set(e,b);this.changed={};this.initialize.apply(this,arguments)};d.extend(v.prototype,p,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(a){return d.clone(this.attributes)},sync:function(){return b.sync.apply(this,
arguments)},get:function(a){return this.attributes[a]},escape:function(a){return d.escape(this.get(a))},has:function(a){return null!=this.get(a)},set:function(a,b,e){var h,f,c,l,r,v,g;if(null==a)return this;"object"===typeof a?(f=a,e=b):(f={})[a]=b;e||(e={});if(!this._validate(f,e))return!1;c=e.unset;l=e.silent;a=[];r=this._changing;this._changing=!0;r||(this._previousAttributes=d.clone(this.attributes),this.changed={});g=this.attributes;v=this._previousAttributes;this.idAttribute in f&&(this.id=
f[this.idAttribute]);for(h in f)b=f[h],d.isEqual(g[h],b)||a.push(h),d.isEqual(v[h],b)?delete this.changed[h]:this.changed[h]=b,c?delete g[h]:g[h]=b;if(!l)for(a.length&&(this._pending=!0),b=0,h=a.length;b<h;b++)this.trigger("change:"+a[b],this,g[a[b]],e);if(r)return this;if(!l)for(;this._pending;)this._pending=!1,this.trigger("change",this,e);this._changing=this._pending=!1;return this},unset:function(a,b){return this.set(a,void 0,d.extend({},b,{unset:!0}))},clear:function(a){var b={},e;for(e in this.attributes)b[e]=
void 0;return this.set(b,d.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!d.isEmpty(this.changed):d.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?d.clone(this.changed):!1;var b,e=!1,h=this._changing?this._previousAttributes:this.attributes,f;for(f in a)d.isEqual(h[f],b=a[f])||((e||(e={}))[f]=b);return e},previous:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return d.clone(this._previousAttributes)},
fetch:function(a){a=a?d.clone(a):{};void 0===a.parse&&(a.parse=!0);var b=this,e=a.success;a.success=function(h){if(!b.set(b.parse(h,a),a))return!1;e&&e(b,h,a);b.trigger("sync",b,h,a)};z(this,a);return this.sync("read",this,a)},save:function(a,b,e){var h,f=this.attributes;null==a||"object"===typeof a?(h=a,e=b):(h={})[a]=b;e=d.extend({validate:!0},e);if(h&&!e.wait){if(!this.set(h,e))return!1}else if(!this._validate(h,e))return!1;h&&e.wait&&(this.attributes=d.extend({},f,h));void 0===e.parse&&(e.parse=
!0);var c=this,l=e.success;e.success=function(a){c.attributes=f;var b=c.parse(a,e);e.wait&&(b=d.extend(h||{},b));if(d.isObject(b)&&!c.set(b,e))return!1;l&&l(c,a,e);c.trigger("sync",c,a,e)};z(this,e);a=this.isNew()?"create":e.patch?"patch":"update";"patch"===a&&(e.attrs=h);a=this.sync(a,this,e);h&&e.wait&&(this.attributes=f);return a},destroy:function(a){a=a?d.clone(a):{};var b=this,e=a.success,h=function(){b.trigger("destroy",b,b.collection,a)};a.success=function(f){(a.wait||b.isNew())&&h();e&&e(b,
f,a);b.isNew()||b.trigger("sync",b,f,a)};if(this.isNew())return a.success(),!1;z(this,a);var f=this.sync("delete",this,a);a.wait||h();return f},url:function(){var a=d.result(this,"urlRoot")||d.result(this.collection,"url")||m();return this.isNew()?a:a+("/"===a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(a){return this._validate({},d.extend(a||
{},{validate:!0}))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=d.extend({},this.attributes,a);var e=this.validationError=this.validate(a,b)||null;if(!e)return!0;this.trigger("invalid",this,e,d.extend(b,{validationError:e}));return!1}});d.each("keys values pairs invert pick omit".split(" "),function(a){v.prototype[a]=function(){var b=g.call(arguments);b.unshift(this.attributes);return d[a].apply(d,b)}});var u=b.Collection=function(a,b){b||(b={});b.model&&(this.model=b.model);
void 0!==b.comparator&&(this.comparator=b.comparator);this._reset();this.initialize.apply(this,arguments);a&&this.reset(a,d.extend({silent:!0},b))},n={add:!0,remove:!0,merge:!0},s={add:!0,remove:!1};d.extend(u.prototype,p,{model:v,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return b.sync.apply(this,arguments)},add:function(a,b){return this.set(a,d.extend({merge:!1},b,s))},remove:function(a,b){var e=!d.isArray(a);a=e?[a]:d.clone(a);b||
(b={});var h,f,c,l;h=0;for(f=a.length;h<f;h++)if(l=a[h]=this.get(a[h]))delete this._byId[l.id],delete this._byId[l.cid],c=this.indexOf(l),this.models.splice(c,1),this.length--,b.silent||(b.index=c,this.trigger("remove",l,this,b)),this._removeReference(l);return e?a[0]:a},set:function(a,b){b=d.defaults({},b,n);b.parse&&(a=this.parse(a,b));var e=!d.isArray(a);a=e?a?[a]:[]:d.clone(a);var h,f,c,l,r,g,A=b.at,B=this.model,u=this.comparator&&null==A&&!1!==b.sort,k=d.isString(this.comparator)?this.comparator:
null,m=[],G=[],q={},s=b.add,D=b.merge,p=b.remove,y=!u&&s&&p?[]:!1;h=0;for(f=a.length;h<f;h++){r=a[h];c=r instanceof v?l=r:r[B.prototype.idAttribute];if(c=this.get(c))p&&(q[c.cid]=!0),D&&(r=r===l?l.attributes:r,b.parse&&(r=c.parse(r,b)),c.set(r,b),u&&!g&&c.hasChanged(k)&&(g=!0)),a[h]=c;else if(s){l=a[h]=this._prepareModel(r,b);if(!l)continue;m.push(l);l.on("all",this._onModelEvent,this);this._byId[l.cid]=l;null!=l.id&&(this._byId[l.id]=l)}y&&y.push(c||l)}if(p){h=0;for(f=this.length;h<f;++h)q[(l=this.models[h]).cid]||
G.push(l);G.length&&this.remove(G,b)}if(m.length||y&&y.length)if(u&&(g=!0),this.length+=m.length,null!=A)for(h=0,f=m.length;h<f;h++)this.models.splice(A+h,0,m[h]);else for(y&&(this.models.length=0),l=y||m,h=0,f=l.length;h<f;h++)this.models.push(l[h]);g&&this.sort({silent:!0});if(!b.silent){h=0;for(f=m.length;h<f;h++)l=m[h],this.trigger("add",l,this,b);(g||y&&y.length)&&this.trigger("sort",this,b)}return e?a[0]:a},reset:function(a,b){b||(b={});for(var e=0,h=this.models.length;e<h;e++)this._removeReference(this.models[e]);
b.previousModels=this.models;this._reset();a=this.add(a,d.extend({silent:!0},b));b.silent||this.trigger("reset",this,b);return a},push:function(a,b){return this.add(a,d.extend({at:this.length},b))},pop:function(a){var b=this.at(this.length-1);this.remove(b,a);return b},unshift:function(a,b){return this.add(a,d.extend({at:0},b))},shift:function(a){var b=this.at(0);this.remove(b,a);return b},slice:function(){return g.apply(this.models,arguments)},get:function(a){return null==a?void 0:this._byId[a.id]||
this._byId[a.cid]||this._byId[a]},at:function(a){return this.models[a]},where:function(a,b){return d.isEmpty(a)?b?void 0:[]:this[b?"find":"filter"](function(b){for(var e in a)if(a[e]!==b.get(e))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw Error("Cannot sort a set without a comparator");a||(a={});d.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(d.bind(this.comparator,
this));a.silent||this.trigger("sort",this,a);return this},pluck:function(a){return d.invoke(this.models,"get",a)},fetch:function(a){a=a?d.clone(a):{};void 0===a.parse&&(a.parse=!0);var b=a.success,e=this;a.success=function(h){e[a.reset?"reset":"set"](h,a);b&&b(e,h,a);e.trigger("sync",e,h,a)};z(this,a);return this.sync("read",this,a)},create:function(a,b){b=b?d.clone(b):{};if(!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var e=this,h=b.success;b.success=function(a,b,f){f.wait&&e.add(a,
f);h&&h(a,b,f)};a.save(null,b);return a},parse:function(a,b){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(a,b){if(a instanceof v)return a.collection||(a.collection=this),a;b=b?d.clone(b):{};b.collection=this;var e=new this.model(a,b);if(!e.validationError)return e;this.trigger("invalid",this,e.validationError,b);return!1},_removeReference:function(a){this===a.collection&&delete a.collection;
a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,e,h){if("add"!==a&&"remove"!==a||e===this)"destroy"===a&&this.remove(b,h),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments)}});d.each("forEach each map collect reduce foldl inject reduceRight foldr find detect filter select reject every all some any include contains invoke max min toArray size first head take initial rest tail drop last without difference indexOf shuffle lastIndexOf isEmpty chain".split(" "),
function(a){u.prototype[a]=function(){var b=g.call(arguments);b.unshift(this.models);return d[a].apply(d,b)}});d.each(["groupBy","countBy","sortBy"],function(a){u.prototype[a]=function(b,e){var h=d.isFunction(b)?b:function(a){return a.get(b)};return d[a](this.models,h,e)}});b.sync=function(a,e,h){var f=H[a];d.defaults(h||(h={}),{emulateHTTP:b.emulateHTTP,emulateJSON:b.emulateJSON});var c={type:f,dataType:"json"};h.url||(c.url=d.result(e,"url")||m());null!=h.data||!e||"create"!==a&&"update"!==a&&"patch"!==
a||(c.contentType="application/json",c.data=JSON.stringify(h.attrs||e.toJSON(h)));h.emulateJSON&&(c.contentType="application/x-www-form-urlencoded",c.data=c.data?{model:c.data}:{});if(h.emulateHTTP&&("PUT"===f||"DELETE"===f||"PATCH"===f)){c.type="POST";h.emulateJSON&&(c.data._method=f);var l=h.beforeSend;h.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",f);if(l)return l.apply(this,arguments)}}"GET"===c.type||h.emulateJSON||(c.processData=!1);"PATCH"===c.type&&q&&(c.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});
a=h.xhr=b.ajax(d.extend(c,h));e.trigger("request",e,a,h);return a};var q="undefined"!==typeof window&&!!window.ActiveXObject&&!(window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),H={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};b.ajax=function(){return b.$.ajax.apply(b.$,arguments)};var F=b.Router=function(a){a||(a={});a.routes&&(this.routes=a.routes);this._bindRoutes();this.initialize.apply(this,arguments)},D=/\((.*?)\)/g,y=/(\(\?)?:\w+/g,E=/\*\w+/g,a=/[\-{}\[\]+?.,\\\^$|#\s]/g;
d.extend(F.prototype,p,{initialize:function(){},route:function(a,e,h){d.isRegExp(a)||(a=this._routeToRegExp(a));d.isFunction(e)&&(h=e,e="");h||(h=this[e]);var f=this;b.history.route(a,function(c){c=f._extractParameters(a,c);h&&h.apply(f,c);f.trigger.apply(f,["route:"+e].concat(c));f.trigger("route",e,c);b.history.trigger("route",f,e,c)});return this},navigate:function(a,e){b.history.navigate(a,e);return this},_bindRoutes:function(){if(this.routes){this.routes=d.result(this,"routes");for(var a,b=d.keys(this.routes);null!=
(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(b){b=b.replace(a,"\\$&").replace(D,"(?:$1)?").replace(y,function(a,b){return b?a:"([^/]+)"}).replace(E,"(.*?)");return RegExp("^"+b+"$")},_extractParameters:function(a,b){var e=a.exec(b).slice(1);return d.map(e,function(a){return a?decodeURIComponent(a):null})}});q="undefined"!==typeof window&&!!window.ActiveXObject&&!(window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent);H={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",
read:"GET"};b.ajax=function(){return b.$.ajax.apply(b.$,arguments)};var e=b.History=function(){this.handlers=[];d.bindAll(this,"checkUrl");"undefined"!==typeof window&&(this.location=window.location,this.history=window.history)},h=/^[#\/]|\s+$/g,A=/^\/+|\/+$/g,B=/msie [\w.]+/,r=/\/$/,G=/[?#].*$/;e.started=!1;d.extend(e.prototype,p,{interval:50,getHash:function(a){return(a=(a||this).location.href.match(/#(.*)$/))?a[1]:""},getFragment:function(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||
b){a=this.location.pathname;var e=this.root.replace(r,"");a.indexOf(e)||(a=a.slice(e.length))}else a=this.getHash();return a.replace(h,"")},start:function(a){if(e.started)throw Error("Backbone.history has already been started");e.started=!0;this.options=d.extend({root:"/"},this.options,a);this.root=this.options.root;this._wantsHashChange=!1!==this.options.hashChange;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);a=
this.getFragment();var f=document.documentMode,f=B.exec(navigator.userAgent.toLowerCase())&&(!f||7>=f);this.root=("/"+this.root+"/").replace(A,"/");f&&this._wantsHashChange&&(this.iframe=b.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(a));if(this._hasPushState)b.$(window).on("popstate",this.checkUrl);else if(this._wantsHashChange&&"onhashchange"in window&&!f)b.$(window).on("hashchange",this.checkUrl);else this._wantsHashChange&&(this._checkUrlInterval=
setInterval(this.checkUrl,this.interval));this.fragment=a;a=this.location;f=a.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!f)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._hasPushState&&f&&a.hash&&(this.fragment=this.getHash().replace(h,""),this.history.replaceState({},document.title,this.root+this.fragment+a.search))}if(!this.options.silent)return this.loadUrl()},
stop:function(){b.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);e.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){a=this.getFragment();a===this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe)));if(a===this.fragment)return!1;this.iframe&&this.navigate(a);this.loadUrl()},loadUrl:function(a){a=this.fragment=this.getFragment(a);return d.any(this.handlers,function(b){if(b.route.test(a))return b.callback(a),
!0})},navigate:function(a,b){if(!e.started)return!1;b&&!0!==b||(b={trigger:!!b});var h=this.root+(a=this.getFragment(a||""));a=a.replace(G,"");if(this.fragment!==a){this.fragment=a;""===a&&"/"!==h&&(h=h.slice(0,-1));if(this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,h);else if(this._wantsHashChange)this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,
a,b.replace));else return this.location.assign(h);if(b.trigger)return this.loadUrl(a)}},_updateHash:function(a,b,e){e?(e=a.href.replace(/(javascript:|#).*$/,""),a.replace(e+"#"+b)):a.hash="#"+b}});b.history=new e;F=b.Router=function(a){a||(a={});a.routes&&(this.routes=a.routes);this._bindRoutes();this.initialize.apply(this,arguments)};D=/\((.*?)\)/g;y=/(\(\?)?:\w+/g;E=/\*\w+/g;a=/[\-{}\[\]+?.,\\\^$|#\s]/g;d.extend(F.prototype,p,{initialize:function(){},route:function(a,e,h){d.isRegExp(a)||(a=this._routeToRegExp(a));
d.isFunction(e)&&(h=e,e="");h||(h=this[e]);var f=this;b.history.route(a,function(c){c=f._extractParameters(a,c);h&&h.apply(f,c);f.trigger.apply(f,["route:"+e].concat(c));f.trigger("route",e,c);b.history.trigger("route",f,e,c)});return this},navigate:function(a,e){b.history.navigate(a,e);return this},_bindRoutes:function(){if(this.routes){this.routes=d.result(this,"routes");for(var a,b=d.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(b){b=b.replace(a,"\\$&").replace(D,
"(?:$1)?").replace(y,function(a,b){return b?a:"([^/]+)"}).replace(E,"(.*?)");return RegExp("^"+b+"$")},_extractParameters:function(a,b){var e=a.exec(b).slice(1);return d.map(e,function(a){return a?decodeURIComponent(a):null})}});v.extend=u.extend=F.extend=e.extend=k}).call(this);
(function(g,b){"function"===typeof define&&define.amd?define("XTemplate",["jQuery","underscore","XUtil"],function(d,c,g){return g.template=b(d,c,g)}):$x.template=b(g.jQuery,g._,g.XUtil)})(this,function(g,b,d){d=function(){b.bindAll(this,"initialize","addTemplate")};d.prototype={_templates:{},_templateTypes:{},initialize:function(){},hasTemplate:function(c){var d=b.has(this._templates,c);d||(c=g("#"+c),d=0<c.length&&(void 0!==c.data("xt-template")||c.is('script[type^="text/template"]')));return d},
getTemplate:function(d){c();b.has(this._templates,d)||this.addTemplate(d);return this._templates[d]},addTemplate:function(d,k,x){c();if(void 0===x||null===x){var p=g("#"+d);if(0==p.length)throw"Must specify a name that corresponds to a template element or provide the template text";p.is('script[type^="text/template"]');x=p.html();void 0===k&&(k=p.data("xt-template"),void 0===k&&(p=p.attr("type"),p=/^text\/template-(.+)$/.exec(p),1<p.length&&(k=p[1])))}if(!b.has(this._templateTypes,k))throw"Unrecognized template type";
k=this._templateTypes[k](x);this._templates[d]=k},registerTemplateType:function(b,c){this._templateTypes[b]=c}};var c=function(){b.has(this._templateTypes,"underscore")||this.registerTemplateType("underscore",function(c){return b.template(c)});b.has(this._templateTypes,"mustache")||"undefined"==typeof Mustache||this.registerTemplateType("mustache",function(b){return Mustache.compile(b)});b.has(this._templateTypes,"handlebars")||"undefined"==typeof Handlebars||this.registerTemplateType("handlebars",
function(b){return Handlebars.compile(b)});b.has(this._templateTypes,"xintricity")||"undefined"==typeof XMVVM||this.registerTemplateType("xintricity",function(b){return XMVVM.Template.compile(b)})},k=new d;d=function(b){return k.getTemplate(b)};d.addTemplate=function(){k.addTemplate.apply(k,arguments)};d.registerTemplateTypes=function(){k.registerTemplateType.apply(k,arguments)};c=b.bind(c,k);return d});
(function(g,b){"function"===typeof define&&define.amd?define("XMVVM-Model",["jQuery","underscore","XUtil","XBase"],function(d,c,k,m){return g.XMVVM=b(d,c,k,m)}):g.XMVVM=b($,_,$x,__XBase__)})(this,function(g,b,d,c){var k={};c.Model.isParentTypeOf=function(b){return c.Model.prototype.isPrototypeOf(b.prototype)};c.Collection.isParentTypeOf=function(b){return c.Collection.prototype.isPrototypeOf(b.prototype)};var m=d.extendClass,z=function(f,c){this.fields||(this.fields={});this.fields&&!b.has(this,"fields")&&
(this.fields=d.extend({},this.fields));b.isFunction(c)&&(c={type:c});b.defaults(c,{persist:!0,type:Object});c.name=f;this.fields[f]=c;this[f]=function(){if(1===arguments.length)this.set(f,arguments[0]);else return this.get(f)}};b.mixin({resultBB:function(f,l,d){void 0===d&&(d=!0);var g=f[l];void 0===g&&f instanceof c.Model&&(g=f.get(l));void 0!==g&&d&&b.isFunction(g)&&(g=g());return g},startsWith:function(b,c){return b.substr(0,c.length)===c},endsWith:function(b,c){var d=b.length-c.length;return 0<=
d&&b.substr(d)===c}});k.Event=c.Event;var x=function(f,c){var d=Array.prototype.slice.call(arguments),g,n=c,s=c.indexOf(":"),q=void 0;b.has(f,n)?q=f[n]:0<=s&&(n=n.substr(0,s+1),b.has(f,n)&&(q=f[n]));if(void 0!==q){var m={};b.each(q,function(b,f){m[b]=d[f+2]});g=new k.Event(m)}return g},p=function(b,c,d,g){Array.prototype.slice.call(arguments);var n;n=null;4<arguments.length&&!(arguments[4]instanceof k.Event)?(n=Array.prototype.slice.call(arguments,3),n.unshift(d),n=x.apply(this,n),n=void 0!==n?[g,
n]:Array.prototype.slice.call(arguments,3)):4===arguments.length?(n={},n[c]=this,n=new k.Event(n),n=[g].concat([n])):n=Array.prototype.slice.call(arguments,3);b.prototype.trigger.apply(this,n)};k.Model=c.Model.extend({constructor:function(f,l){var d=this;b.bindAll(this,"createField","set");b.defaults(d,{fields:{}});b.chain(d.fields).keys().each(function(f){d[f]=b.bind(d[f],d)});c.Model.apply(this,[f,l])},fields:{},createField:function(f,c){z.call(this,f,c);this[f]=b.bind(this[f],this)},clone:function(){var f=
new this.constructor(this.attributes);b.chain(f.fields).keys().each(function(c){f[c]=b.bind(f[c],f)});f.fields=d.extend({},this.fields);b.each(f.fields,function(b,c,d){f.constructor.prototype&&f.constructor.prototype.fields&&f.constructor.prototype.fields[c]||f.createField(c,b)});return f},toJSON:function(){var f=this,c=b.clone(f.attributes);b.each(c,function(d,g){if(!b.has(f.fields,g)||f.fields[g].persist)if(d instanceof k.Model||d instanceof k.Collection)c[g]=d.toJSON()});return c},trigger:b.partial(p,
c.Model,"model",{add:["model","collection","options"],remove:["model","collection","options"],destroy:["model","collection","options"],change:["model","options"],"change:":["model","value","options"],request:["model","xhr","options"],sync:["model","resp","options"],error:["model","xhr","options"],invalid:["model","error","options"]}),set:function(f,d,g){var k=this,n,s,q=k.fields;b.isObject(f)?(n=f,g=d):(n={})[f]=d;var m=b.clone(n);b.each(n,function(f,d,l){var g,a;l=f;if(null!==q&&b.has(q,d)&&(g=q[d],
l=k._prepareValue(g,f),a=!0,b.isFunction(g.validate)&&(a=g.validate(f)),!0!==a))throw a;s=k[d];null!==s&&(s instanceof c.Model||s instanceof c.Collection)&&s.off("all",e,this);if(l instanceof c.Model||l instanceof c.Collection){var e=function(a,e){var f=Array.prototype.slice.call(arguments);b.has(e,"model")&&e.model===k||b.has(e,"recipients")&&b.has(e.recipients,k.cid)||(e.bubble(),e.recipients=e.recipients||{},e.recipients[k.cid]=!0,k.trigger.apply(k,f))};(f=k.get(d))&&f.off("all",e,k.cid+d);l.on("all",
e,k.cid+d)}m[d]=l});c.Model.prototype.set.apply(this,[m,g])},_prepareValue:function(f,d){if(void 0===d||null===d)return d;switch(f.type){case "int":"int"!==typeof d&&(d=parseInt(d));break;case Number:b.isNumber(d)||(d=parseFloat(d));break;case Boolean:b.isBoolean(d)||(d=!0==d);break;case String:b.isString(d)||(d+="");break;case Date:d instanceof Date||(b.isNumber(d)?d=new Date(d):b.isString(d)&&(d=Date.parse(d)));break;case Array:if(!(d instanceof Array))throw"Type mismatch";break;default:if(!(d instanceof
f.type))if((f.type===c.Model||c.Model.isParentTypeOf(f.type))&&b.isObject(d)||(f.type===c.Collection||c.Collection.isParentTypeOf(f.type))&&(b.isObject(d)||b.isArray(d)))d=new f.type(d);else if(!(d instanceof f.type))throw"Type mismatch";}return d},parse:function(f){var d={};b.each(this.fields,function(b,g,k){c.Model.isParentTypeOf(b.type)||c.Collection.isParentTypeOf(b.type)?d[b.name]=new b.type(f[b.name],{parse:!0}):d[b.name]=f[b.name]});return d}});k.Model.extend=function(f,c){if(f.fields){var d=
f.fields;delete f.fields}var g=m.call(this,f,c);d&&(f.fields=d);this.prototype.fields&&b.each(this.prototype.fields,function(b,f){z.call(g.prototype,f,b)});b.has(f,"fields")&&b.each(f.fields,function(b,f){z.call(g.prototype,f,b)});return g};k.Model.createField=function(b,c,d){z.call(b,c,d)};k.Model.defaults={useGetSet:!1};k.Collection=c.Collection.extend({unique:function(){var f=array.slice.call(arguments);f.unshift(this.models);return b.unique.apply(b,f)},_onModelEvent:function(b,d,g,k){"add"!==
b&&"remove"!==b||g===this?c.Collection.prototype._onModelEvent.apply(this,arguments):this.trigger.apply(this,arguments)},trigger:b.partial(p,c.Collection,"collection",{add:["model","collection","options"],remove:["model","collection","options"],destroy:["model","collection","options"],reset:["collection","options"],sort:["collection","options"],request:["collection","xhr","options"],sync:["collection","resp","options"],error:["collection","xhr","options"]})});k.ViewModel=k.Model.extend({view:null,
fields:{model:Object},render:function(){this.view&&(this.$el=d.template(this.view)(this.model(),{context:{viewmodel:this}}));return this.$el},dispose:function(){this.$el&&this.view&&d.template(this.view)("destroy",this.$el)}});var C=function(b,c){if(1==arguments.length)return this.get(b);this.set(b,c)};k.Filters=b.extend({},{isFalse:function(b){return!1===b},isNull:b.isNull,isUndefined:b.isUndefined,isObject:b.isObject,isNullOrUndefined:function(b){return void 0===b||null===b},isEmpty:function(b){return void 0===
b||null===b||""===b},isEqualTo0:function(b){return 0===b},isEqualTo1:function(b){return 1===b},isGreaterThan0:function(b){return 0<b},isLessThan0:function(b){0>b},add1:function(b){return b+1},subtract1:function(b){return b-1}});k.BindingExpression=function(c){c&&b.extend(this,c)};b.extend(k.BindingExpression.prototype,{toString:function(){for(var c="{",d=b.keys(this).sort(),c=c+('"'+d[0]+'","'+this[d[0]]+'"'),g=1;g<d.length;g++)c+=',"'+d[g]+'","'+this[d[g]]+'"';return c+"}"}});k.ModelNavMixins={splitModelPath:function(b){return b.match(/\w+(?=\.?)|(?=\[)\w+(?=\])/g)},
resolveModelPath:function(b,c,d){return this.resolveModelExpression(b,{path:c},d)},resolveModelExpression:function(f,d,g){var k=d.path;if(3>arguments.length||void 0===g)g={};g=b.defaults(g,{evalVal:!0,allowPartial:!0});g=b.defaults(g,{applyFilter:g.evalVal});var n=[f];if("undefined"!==typeof k&&null!==k&&""!==k){for(var k=k instanceof Array?k:this.splitModelPath(k),m=0;m<k.length;m++){var q=n[n.length-1];if(null==q&&g.allowPartial)break;else if(null==q){n=void 0;break}q=q instanceof c.Collection?
q.at(k[m]):!q[k[m]]&&q instanceof c.Model&&q.has(k[m])?b.bind(C,q,k[m]):m<k.length-1||g.evalVal?b.resultBB(q,k[m]):q[k[m]];if("undefined"===typeof q){g.allowPartial||(n=void 0);break}n.push(q)}k=void 0!==n&&null!==n&&0<n.length?b.last(n):n;g.applyFilter&&(m=this._applyBindExpression(d,k,f),m!==k&&n.push(m));return n}},resolveModelExpressionValue:function(c,d){var g=this.resolveModelExpression(c,d,{allowPartial:!1});return g=void 0!==g&&b.isArray(g)&&0<g.length?b.last(g):void 0},_applyBindExpression:function(c,
g,m){if(b.has(c,"filter")&&b.isString(c.filter)){m=m.clone();m.createField("Filter",Object);m.set("Filter",k.Filters);c=this.resolveModelPath(m,c.filter,{evalVal:!1,allowPartial:!1});if(b.isArray(c))c=b.last(c);else throw"Invalid filter, path does not exist";if(b.isFunction(c))g=c(g);else throw"Invalid filter, not a function";}else b.has(c,"pattern")&&b.isString(c.pattern)&&(g=d.format(c.Pattern,g));return g},bindModelPath:function(b,c,d,g){this.bindModelExpression(b,{path:c},d,g)},bindModelExpression:function(d,
g,m,p){var n=this.splitModelPath(g.path),s=this.resolveModelPath(d,n),q={model:d,expression:g,callback:m},x=function(c){var d=b.indexOf(s,c.model);return 0>d||d==n.length||0!==d&&!b.has(c.model.changed,n[d])?!1:!0};b.has(this,"_bindingCallbacks")||(this._bindingCallbacks=[]);q.checkCallback=b.bind(function(g,l){var p;p=!1;switch(g){case "change":p=Array.prototype.slice.call(arguments,1,arguments.length);p=x.apply(this,p);break;case "add":case "remove":p=b.indexOf(s,l.collection),p=0<=p&&(p===s.length-
1||b.indexOf(s,l.collection)===p+1)}if(p=p&&!((this instanceof c.Model||this instanceof c.Collection)&&b.has(l,"recipients")&&b.has(l.recipients,this.cid))){s=this.resolveModelPath(d,n);l.recipients=b.has(l,"recipients")?l.recipients:{};l.recipients[this.cid]=!0;m.apply(this,arguments);p=new k.Event;p.oldValue=q.value;var u=this.resolveModelExpression(q.model,q.expression),u=u.length===n.length+1?b.last(s):void 0;p.value=u;q.value=u;m.apply(this,[p])}},this);this._bindingCallbacks.push(q);d.on("all",
q.checkCallback,this)},unbindModelPath:function(b,c,d){this.unbindModelExpression(b,{path:c},d)},unbindModelExpression:function(c,d,g){var k=b.find(this._bindingCallbacks,function(k){return k.model===c&&b.isEqual(k.expression,d)&&k.callback===g});c.off("all",k.checkCallback,this)},setModelPathValue:function(d,g,k,m){m=void 0===m?!0:m;g=b.isArray(g)?g:this.splitModelPath(g);d=this.resolveModelPath(d,g,{evalVal:!1,allowPartial:!1});var n=d.length,p=d[n-1];m&&b.isFunction(p)?p(k):p instanceof c.Collection?
d[n-2].update(k):d[n-2][g[n-1]]=k}};k.Router=c.Router.extend({initialize:function(d){var k=this;b.bindAll(this,"canRoute");d=d||{};b.defaults(d,{root:"/",startHistory:!0,pushState:!0});d.startHistory&&c.history.start({pushState:d.pushState,root:d.root});var m=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")+d.root;g(document).on("click","a:not([data-bypass])",function(b){var d=g(this).attr("href");d.substr(0,m.length)===m&&"_blank"!==g(this).attr("target")&&"external"!==
g(this).attr("rel")&&(d=d.substr(m.length),k.canRoute(d)?(b.preventDefault(),k.navigate(d,{trigger:!0})):d==c.history.fragment&&b.preventDefault())})},canRoute:function(d){if(!c.History.started)return!1;d=c.history.getFragment(d||"");d=d.replace(/[?#].*$/,"");if(d===c.history.fragment)return!1;d=c.history.getFragment(d);return b.any(c.history.handlers,function(b){if(b.route.test(d))return!0})}});return k});
(function(g,b){"function"===typeof define&&define.amd?define(["jQuery","underscore","XUtil","XMVVM-Model"],function(d,c,k,m){return g.XMVVM=b(d,c,k,m,XBase)}):g.XMVVM=b(g.jQuery,g._,g.XUtil,g.XMVVM)})(this,function(g,b,d,c){c.NodeTypes=[];var k=c.templateNode=function(a){a=b.defaults(a,{childNodes:[],el:null,$el:null,inner:null,parent:null});a.el&&!a.$el&&(a.$el=g(a.el));a.$el instanceof g||(a.$el=g(a.$el));a.el=a.$el.get(0);b.extend(this,a);this.initialize()};b.extend(k.prototype,{initialize:function(){b.bindAll(this,
"createInstance")},createInstance:function(a,b){return this.type.createInstance(this,a,b)}});var m=function(a,e){var h=a;b.each(e,function(a){h=h.contents().eq(a)});return h},z=c.templateParser=function(){this.initialize()};b.extend(z.prototype,{initialize:function(){b.bindAll(this,"parse","_parse","calculatePosition");var a=this;a.childScopeSelector="";a.parseFunctions={};b.each(c.NodeTypes,function(e){e=b.defaults(e,{name:null,type:"bind",selector:null,parse:null,render:null});if(null===e.name||
""===e.name)throw"Parser must specify a name";if(null===e.parse||!b.isFunction(e.parse))throw"Must specify a valid parse function";if("block"===e.type&&(null==e.selector||""==e.selector))throw"If parser is a block, must specify a selector for all nested scopes.";a.parseFunctions[e.name]=b.bind(e.parse,a);"block"===e.type&&(""!=a.childScopeSelector&&(a.childScopeSelector+=","),a.childScopeSelector+=e.selector)});var e=function(b,e){return 0<g(this).parentsUntil(b,a.childScopeSelector).length};a.excludeNestedScopes=
function(a){return b.partial(e,a)}},parse:function(a){var e=[];"undefined"===typeof this.parserFunctions&&this.initialize();a=new k({el:g(a),inner:g(a).children()});for(e=e.concat(this._parse(a));0<e.length;){var h=e.shift(),h=this._parse(h);b.isArray(h)&&0<h.length&&e.push.apply(e,h)}return a},_parse:function(a){var e=this,h=[],d=c.NodeTypes;b.each(b.where(d,{type:"tree"}),function(b){h=h.concat(e.parseFunctions[b.name](a)||[])});b.each(b.where(d,{type:"block"}),function(b){h=h.concat(e.parseFunctions[b.name](a)||
[])});var g=a.$el.find("*").not(e.childScopeSelector).not(e.excludeNestedScopes(a.$el)).add(a.$el);b.each(b.where(d,{type:"bind"}),function(b){g.each(function(h,c){e.parseFunctions[b.name](a,c)})});return h},calculatePosition:function(a,b){if(a===b)return[];a=g(a);b=g(b);var h=a.parentsUntil(b);if(0!==a.closest(b).length){var c=[a.parent().contents().index(a)];h.each(function(a,b){var e=g(b);c.unshift(e.parent().contents().index(e))});return c}},parseBinding:function(a,e){var h={},d,g=/^\{\{(?:\s*(Path|Filter|Pattern|HTML)\s*=\s*(?:'([^']*)'|"([^"]*)")\s*\,?)+\}\}$/ig,
f=/(Path|Filter|Pattern|HTML)\s*=\s*('[^']*'|"[^"]*")\s*/ig;1===arguments.length&&(e=!0);d=a.match(/^\{\{([\w\.\[\]]+)\}\}$/i);if(null!==d&&1<d.length)h.path=d[1];else if(e)if(null!==g.exec(a)){for(;d=f.exec(a);)h[d[1].toLowerCase()]=d[2].substring(1,d[2].length-1);h.hasOwnProperty("path")||(h=void 0)}else h=a;else h=a;return b.isObject(h)?new c.BindingExpression(h):h}});var x=c.cssTriggerNodeType={name:"css-trigger",type:"tree",parse:function(a){var e=this,h=[];a.$el.find("[data-xt-event][data-xt-class]:first-child, [data-xt-event]+[data-xt-event][data-xt-class], [data-xt-event][data-xt-style]:first-child, [data-xt-event]+[data-xt-event][data-xt-style]").not(e.excludeNestedScopes(a.$el)).each(function(c,
d){var f=g(d),l={$el:f},m=[];f.is("[data-xt-style]")&&(m=f.data("xt-style").split(";"));var n=f.data("xt-class");l.event=f.data("xt-event");l.type=x;l.position=e.calculatePosition(g(d).parent(),a.$el);void 0!==m&&0<m.length&&(l.styles={},b.each(m,function(a){a=a.split(":");2===a.length&&(l.styles[a[0].trim()]=a[1].trim())}));void 0!==n&&(l.cssClass=n);h.push(new k(l))});a.childNodes=a.childNodes.concat(h);return[]},createInstance:function(a,e,h){e={event:a.event,el:m(e,a.position),context:h};b.has(a,
"styles")&&(e.styles=a.styles);b.has(a,"cssClass")&&(e.cssClass=a.cssClass);return new c.StyleTrigger(e)}};c.NodeTypes.push(x);var p=c.actionTriggerNodeType={name:"action-trigger",type:"tree",parse:function(a){var b=this,h=[];a.$el.find("[data-xt-event][data-xt-action]:first-child, [data-xt-event]+[data-xt-event][data-xt-action]").not(b.excludeNestedScopes(a.$el)).each(function(c,d){var f=g(d),l={$el:f},m=f.data("xt-data");l.event=f.data("xt-event");l.action=b.parseBinding(f.data("xt-action"),!1);
l.type=p;l.position=b.calculatePosition(g(d).parent(),a.$el);void 0!==m&&(l.data=b.parseBinding(m,!1));h.push(new k(l));f.remove()});a.childNodes=a.childNodes.concat(h);return[]},createInstance:function(a,e,h){e={event:a.event,el:m(e,a.position),context:h,action:a.action};b.has(a,"data")&&(e.data=a.data);return new c.ActionTrigger(e)}};c.NodeTypes.push(p);var C=c.foreachNodeType={name:"foreach",type:"block",selector:"[data-xt-foreach]",parse:function(a){var b=this,h=[];a.$el.find("[data-xt-foreach]").not(b.excludeNestedScopes(a.$el)).each(function(c,
d){var f=g(d),f={$el:g(d),type:C,position:b.calculatePosition(f,a.$el),expression:b.parseBinding(f.data("xt-foreach")),iterator:f.data("xt-iterator"),indexer:f.data("xt-index")};h.push(new k(f))});a.childNodes=a.childNodes.concat(h);return h},createInstance:function(a,b,h){b=m(b,a.position);a=new y({block:a,context:h,el:b});a.render();return a}};c.NodeTypes.push(C);var f=c.ifNodeType={name:"if-else",type:"block",selector:"[data-xt-if],[data-xt-elseif],[data-xt-else]",parse:function(a){var b=this,
h=[];a.$el.find("[data-xt-if]").not(b.excludeNestedScopes(a.$el)).each(function(c,d){var r=g(d),l=new k({el:d,type:f,position:b.calculatePosition(r,a.$el),branches:[],defaultBranch:null});do{var m=r.is("[data-xt-if]")?r.data("xt-if"):r.data("xt-elseif"),m=new k({el:r,type:f,subType:"branch",expression:b.parseBinding(m)});r.is("[data-xt-onrender]")&&(m.onrender=b.parseBinding(r.data("xt-onrender")));l.branches.push(m);h.push(m);r=r.next()}while(r.is("[data-xt-elseif]"));r.is("[data-xt-else]")&&(l.defaultBranch=
new k({el:r,type:f,subType:"else"}),h.push(l.defaultBranch),r.is("[data-xt-onrender]")&&(l.defaultBranch.onrender=b.parseBinding(r.data("xt-onrender"))));a.childNodes.push(l)});return h},createInstance:function(a,b,c){b=m(b,a.position);a=new D({block:a,context:c,el:b});a.render();return a}};c.NodeTypes.push(f);var l=c.partialNodeType={name:"partial",type:"block",selector:"[data-xt-partial]",parse:function(a){var e=this;a.$el.find("[data-xt-partial]").not(e.excludeNestedScopes(a.$el)).each(function(c,
d){var f=g(d),r=f.data("xt-model");r&&(r=e.parseBinding(r));var m=f.data("xt-partial");if(void 0===r){var n=e.parseBinding(m);b.isObject(n)&&(r=n,m=void 0)}a.childNodes.push(new k({$el:f,type:l,position:e.calculatePosition(f,a.$el),template:m,model:r}))})},createInstance:function(a,b,c){b=m(b,a.position);a=new F({block:a,context:c,el:b});a.render();return a}};c.NodeTypes.push(l);var v=c.attributeBindingNodeType={name:"attribute-binding",type:"bind",parse:function(a,e){var c=g(e),d=this;b.each(e.attributes,
function(e){var f=e.name;"data-xt-"===f.substr(0,8)&&"data-xt-src"!==f||"type"===f||(e=e.value,e=d.parseBinding(e),b.isObject(e)&&a.childNodes.push(new k({expression:e,type:v,position:d.calculatePosition(c,a.$el),attr:f})))})},createInstance:function(a,b,d){b=m(b,a.position);return new c.AttributeBinding({model:d,el:b,expression:a.expression,attr:a.attr})}};c.NodeTypes.push(v);var u=c.cssBindingNodeType={name:"css-binding",type:"bind",parse:function(a,e){var c=g(e),d=this,f=b.filter(e.attributes,
function(a){return b.startsWith(a.name,"data-xt-class-")});b.each(f,function(e){var f=e.name;e=e.value;e=d.parseBinding(e);b.isObject(e)&&a.childNodes.push(new k({expression:e,type:u,position:d.calculatePosition(c,a.$el),cssClass:f.substr(14)}))})},createInstance:function(a,b,d){b=m(b,a.position);return new c.CssClassBinding({model:d,el:b,expression:a.expression,cssClass:a.cssClass})}};c.NodeTypes.push(u);var n=c.textBindingNodeType={name:"text-binding",type:"bind",textBindingPattern:/\{\{([a-zA-Z][\w\._]*|([a-zA-z]\w*\s*=\s*('[^']*'|"[^"]*"),?\s*)+)\}\}/g,
parse:function(a,e){var c=this,d=g(e),f=d.contents();b.each(f.filter(function(){return 3==this.nodeType}),function(b){b=n.createBinding.call(c,b,a.$el,b.nodeValue);null!==b&&a.childNodes.push(b)});b.each(d.get(0).attributes,function(e){b.isObject(c.parseBinding(e.value))||(e=n.createBinding.call(c,d,a.$el,e.value,e.name),null!==e&&a.childNodes.push(e))})},createBinding:function(a,e,c,d){var f=this;a=g(a);for(var l=[],m=null;m=n.textBindingPattern.exec(c);)l.push(m[0]);if(null!=l&&0<l.length){var p=
b.uniq(l),l=b.map(p,function(a){return f.parseBinding(a)});c.replace(/\{/,"&#123;").replace(/\}/,"&#125;");c=c.replace(n.textBindingPattern,function(a){return"{"+b.indexOf(p,a)+"}"});e={type:n,paths:l,pattern:c,position:f.calculatePosition(a,e)};void 0!==d&&(e.attribute=d);return new k(e)}return null},createInstance:function(a,e,d){e=m(e,a.position);d={model:d,el:e,paths:a.paths,pattern:a.pattern};b.has(a,"attribute")&&(d.attribute=a.attribute);return new c.TextNodeBinding(d)}};c.NodeTypes.push(n);
var s=c.selectBindingNodeType={name:"select-binding",type:"bind",parse:function(a,b){var c=g(b);if(c.is("[data-xt-options]")){var d=c.data("xt-options"),d={el:b,type:s,path:d.substr(2,d.length-4),position:this.calculatePosition(c,a.$el)},f=c.data("xt-text-field"),c=c.data("xt-value-field");void 0!==f&&null!==f&&(d.textField=f);void 0!==c&&null!==c&&(d.valueField=c);c=new k(d);a.childNodes.push(c)}},createInstance:function(a,b,d){b=m(b,a.position);return new c.SelectBinding({model:d,el:b,path:a.path,
textField:a.textField,valueField:a.valueField})}};c.NodeTypes.push(s);c.Binding=function(){};c.Binding.extend=d.extendClass;c.AttributeBinding=c.Binding.extend({constructor:function(a){this.options=d.extend({},a);this.options=b.defaults(this.options,this.defaults);if(null===this.options.model||null===this.options.path||null===this.options.el||null===this.options.attr)throw"model, path, el, and attr options are required";"value"!==this.options.attr&&(this.options.updateModel=!1);this.$el=g(this.options.el);
b.bindAll(this,"value","setModelAttr","modelChanged","bindModel","unbindModel","bindEl","setElProp","elChanged","dispose");this.bindModel();this.bindEl();this.initialize()},initialize:function(){this.options.updateElement&&this.setElProp(this.value());this.options.updateModel&&this.setModelAttr(this.$el.attr(this.options.attr))},defaults:{model:null,expression:null,el:null,attr:null,updateModel:!0,updateElement:!0},bindModel:function(){this._modelPath=this.resolveModelExpression(this.options.model,
this.options.expression,{evalVal:!1,applyFilter:!1,allowPartial:!1});this.bindModelExpression(this.options.model,this.options.expression,this.modelChanged)},unbindModel:function(){this.unbindModelExpression(this.options.model,this.options.expression,this.modelChanged)},value:function(){if("undefined"!==typeof this._modelPath&&0!==this._modelPath.length){var a=this._modelPath[this._modelPath.length-1];b.isFunction(a)&&(a=a());return this._applyBindExpression(this.options.expression,a,this.options.model)}},
setModelAttr:function(a){var e=this._modelPath;if(void 0===e||null===e)throw"Xintricity cannot set model value, expression does not exist: "+this.options.expression.path;var c=e.length,d=this.splitModelPath(this.options.expression.path);if(0<c&&b.isFunction(e[c-1]))e[c-1](a);else e[c-2][b.last(d)]=a},modelChanged:function(a,b,c){this._modelPath=this.resolveModelExpression(this.options.model,this.options.expression,{evalVal:!1,applyFilter:!1,allowPartial:!1});this.options.updateElement&&"id"!==this.options.attr&&
this.setElProp(this.value())},bindEl:function(){if(3==this.options.el.nodeType)throw"Attribute binding cannot be used with text nodes";this.$el.on("change.binding",this.elChanged)},unbindEl:function(){this.$el.off("change.binding",this.elChanged);this._modelPath=null},setElProp:function(a){this.options.updateElement&&("value"===this.options.attr?this.$el.val(a):"data-xt-src"==this.options.attr&&this.$el.is("img")?this.$el.attr("src",a):this.$el.attr(this.options.attr,a))},elChanged:function(a,b){this.setModelAttr(g(a.target).val())},
dispose:function(){this.unbindModel();this.unbindEl()}});d.extend(c.AttributeBinding.prototype,c.ModelNavMixins);c.TextNodeBinding=c.Binding.extend({constructor:function(a){this.options=d.extend({},a);this.options=b.defaults(this.options,this.defaults);if(null===this.options.model||null===this.options.paths||0===this.options.paths.length||null===this.options.el||null==this.options.pattern)throw"model, path, el, and attr options are required";this.options.el instanceof g&&(this.options.el=this.options.el.get(0));
this._modelPaths={};this._callbacks={};b.bindAll(this,"initialize","value","modelChanged","bindModel","updateText","dispose");this.bindModel();this.initialize()},initialize:function(){this.updateText()},defaults:{model:null,paths:null,el:null,pattern:null},bindModel:function(a){var e=this;b.each(1===arguments.length?[a]:this.options.paths,function(a){e._callbacks[a]=b.bind(e.modelChanged,e,a);e.bindModelExpression(e.options.model,a,e._callbacks[a])})},value:function(a){a=this.resolveModelExpression(this.options.model,
a,{evalVal:!0,allowPartial:!1});return b.isArray(a)&&0<a.length?b.last(a):void 0},modelChanged:function(a){this.updateText()},updateText:function(){var a=this,e=[a.options.pattern],c=!1;b.each(a.options.paths,function(d){var f=a.value(d),f=void 0==f?"":f.toString();b.has(d,"html")&&"true"===d.html?(e.push(f),c=!0):(f=f?a.escapeHtml(f):f,e.push(f))});var f=d.format.apply(this,e).replace(/&#123;/,"{").replace(/&#125;/,"}");if(b.has(a.options,"attribute"))g(a.options.el).attr(a.options.attribute,a.escapeEntities(f));
else if(c){var k=document.createElement("div"),l=g(a.options.el).parent().get(0),m=a.options.el;m instanceof NodeList||(m=[a.options.el]);k.innerHTML="<div>"+f+"</div>";k=k.children;b.each(k,function(a){l.insertBefore(a,m[0])});b.each(m,function(a){l.removeChild(a)});0<g(k).parents("html").length&&g(k).filter("script").each(function(){g.globalEval(this.text||this.textContent||this.innerHTML||"")});a.options.el=k}else a.options.el.nodeValue=a.escapeEntities(f)},escapeHtml:function(a){return a.replace(/&<>"/g,
function(a){return c.TextNodeBinding.HtmlEntities[a]})},escapeEntities:function(a){return a.replace(/[^\x20-\x7E]/g,function(a){return c.TextNodeBinding.EntityCodes[a]?"&"+c.TextNodeBinding.EntityCodes[a]+";":a})},dispose:function(){var a=this;b.each(this.options.paths,function(b){a.unbindModelExpression(a.options.model,b,a._callbacks[b])});a._modelPaths={};a._callbacks={};delete a._callbacks;delete a._modelPaths}});d.extend(c.TextNodeBinding.prototype,c.ModelNavMixins);c.TextNodeBinding.HtmlEntities=
{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};c.TextNodeBinding.EntityCodes={apos:39,quot:34,amp:38,lt:60,gt:62,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,copy:169,ordf:170,laquo:171,not:172,shy:173,reg:174,macr:175,deg:176,plusmn:177,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,sup1:185,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,Agrave:192,Aacute:193,Acirc:194,Atilde:195,Auml:196,Aring:197,AElig:198,Ccedil:199,
Egrave:200,Eacute:201,Ecirc:202,Euml:203,Igrave:204,Iacute:205,Icirc:206,Iuml:207,ETH:208,Ntilde:209,Ograve:210,Oacute:211,Ocirc:212,Otilde:213,Ouml:214,times:215,Oslash:216,Ugrave:217,Uacute:218,Ucirc:219,Uuml:220,Yacute:221,THORN:222,szlig:223,agrave:224,aacute:225,acirc:226,atilde:227,auml:228,aring:229,aelig:230,ccedil:231,egrave:232,eacute:233,ecirc:234,euml:235,igrave:236,iacute:237,icirc:238,iuml:239,eth:240,ntilde:241,ograve:242,oacute:243,ocirc:244,otilde:245,ouml:246,divide:247,oslash:248,
ugrave:249,uacute:250,ucirc:251,uuml:252,yacute:253,thorn:254,yuml:255,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,
pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,
darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,"int":8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,
lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830};c.CssClassBinding=c.Binding.extend({constructor:function(a){this.options=d.extend({},a);this.options=b.defaults(this.options,this.defaults);if(null===this.options.model||null===this.options.path||null===this.options.el||null===this.options.cssClass)throw"model, path, cssClass, and el are required";this.$el=g(this.options.el);b.bindAll(this,"value","modelChanged","bindModel","unbindModel","setElClasses","dispose");this.bindModel();
this.initialize()},initialize:function(){this.setElClasses(this.value())},defaults:{model:null,expression:null,el:null,attr:null},bindModel:function(){this._modelPath=this.resolveModelExpression(this.options.model,this.options.expression,{evalVal:!1,allowPartial:!1});this.bindModelExpression(this.options.model,this.options.expression,this.modelChanged)},unbindModel:function(){this.unbindModelExpression(this.options.model,this.options.expression,this.modelChanged)},value:function(){if("undefined"!==
typeof this._modelPath&&0!==this._modelPath.length){var a=this._modelPath[this._modelPath.length-1];b.isFunction(a)&&(a=a());return this._applyBindExpression(this.options.expression,a,this.options.model)}},modelChanged:function(a,b,c){this._modelPath=this.resolveModelExpression(this.options.model,this.options.expression,{evalVal:!1,allowPartial:!1});this.setElClasses(this.value())},setElClasses:function(a){a?this.$el.addClass(this.options.cssClass,a):this.$el.removeClass(this.options.cssClass,a)},
dispose:function(){this.unbindModel()}});d.extend(c.CssClassBinding.prototype,c.ModelNavMixins);c.SelectBinding=c.Binding.extend({constructor:function(a){this.options=d.extend({},a);this.options=b.defaults(this.options,this.defaults);if(null===this.options.model||null===this.options.path||null===this.options.el)throw"model, path, and el options are required";this.$el=g(this.options.el);b.bindAll(this,"value","bindModel","unbindModel","modelChanged","bindEl","createOptions","dispose");this.bindModel();
this.bindEl();this.initialize()},initialize:function(){var a=this.$el.val();this.createOptions(this.value());this.$el.val()!=a&&this.$el.trigger("change")},defaults:{model:null,path:null,el:null,textField:"name",valueField:"value"},bindModel:function(){this._modelPath=this.resolveModelPath(this.options.model,this.options.path,{evalVal:!1,allowPartial:!1});this.bindModelPath(this.options.model,this.options.path,this.modelChanged)},unbindModel:function(){var a=this;b.each(a._bindingCallbacks,function(b,
c){a.unbindModelPath(b.model,b.path,b.callback)});this._bindingCallbacks=[]},value:function(){if("undefined"!==typeof this._modelPath&&0!==this._modelPath.length){var a=this._modelPath[this._modelPath.length-1];return b.isFunction(a)?a():a}},modelChanged:function(a,b,c){this._modelPath=this.resolveModelPath(this.options.model,this.options.path,{evalVal:!1,allowPartial:!1});this.createOptions(this.value())},bindEl:function(){if(!this.options.el.is("select"))throw"el must be of node type <select>";
g(this.options.el)},unbindEl:function(){g(t.options.el).off("change.binding",t.elChanged);this._modelPath=null},createOptions:function(a){var e=this,d=g(e.options.el),f=d.val();d.empty();var k=function(a,c,f){c=b.resultBB(a,e.options.textField);a=b.resultBB(a,e.options.valueField);f=g(document.createElement("option"));f.text(c).val(a);d.append(f)};a instanceof c.Collection?a.each(k):b.each(a,k);d.val(f)},dispose:function(){this.unbindModel();this.unbindEl()}});d.extend(c.SelectBinding.prototype,c.ModelNavMixins);
c.Trigger=function(a){if(null===arguments||0===arguments.length)a={};this.options=b.defaults(a,this.defaults);this.initialize.apply(this)};d.extend(c.Trigger.prototype,{defaults:{el:null,event:"click"},initialize:function(){b.bindAll(this,"onTrigger","onTriggerInv","onTriggerInternal","onTriggerInvInternal","bind","unbind","dispose");this.bind()},onTrigger:function(a){},onTriggerInv:function(a){},onTriggerInternal:function(a){var b=new c.Event({event:this.options.event,target:a.target});this.onTrigger(b);
b.isDefaultPrevented()&&a.preventDefault()},onTriggerInvInternal:function(a){var b=new c.Event({event:this.options.event});this.onTrigger(b);b.isDefaultPrevented()&&a.preventDefault()},bind:function(){var a=g(this.options.el);switch(this.options.event){case null:throw"Event name cannot be null";case "hover":a.on("mouseenter.binding",this.onTriggerInternal);a.on("mouseleave.binding",this.onTriggerInvInternal);break;default:a.on(this.options.event+".binding",this.onTriggerInternal)}},unbind:function(){var a=
g(this.options.el);switch(this.options.event){case null:throw"Event name cannot be null";case "hover":a.off("mouseenter.binding",this.onTriggerInternal);a.on("mouseleave.binding",this.onTriggerInvInternal);break;default:a.off(this.options.event+".binding",this.onTriggerInternal)}},dispose:function(){this.unbind()}});c.Trigger.extend=d.extendClass;c.StyleTrigger=c.Trigger.extend({initialize:function(){c.Trigger.prototype.initialize.call(this)},defaults:{el:null,event:"click",target:null},onTrigger:function(){var a=
this,c=g(a.options.el),d=c;null!=a.options.target&&(d=a.getTarget(c));null!=a.options.cssClass&&(a.options.cssClass instanceof Array?b.each(a.options.cssClass,function(a,b,c){d.addClass(a)}):d.addClass(a.options.cssClass));null!=a.options.styles&&(a.prevStyles={},b.each(a.options.styles,function(b,c,e){a.prevStyles[c]=d.css(c);d.css(c,b)}))},onTriggerInv:function(){var a=$el;null!=t.options.target&&(a=t.getTarget($el));null!=this.options.cssClass&&(this.options.cssClass instanceof Array?b.each(this.options.cssClass,
function(b,c,d){a.removeClass(b)}):a.removeClass(this.options.cssClass));null!=this.options.styles&&(this.prevStyles={},b.each(this.options.styles,function(b,c,d){a.css(c,this.prevStyles[c])}))},getTarget:function(a){return a}});d.extend(c.StyleTrigger.prototype,c.ModelNavMixins);c.Actions=b.extend({},{});c.ActionTrigger=c.Trigger.extend({defaults:{el:null,event:"click",context:{},action:null,data:void 0},initialize:function(){c.Trigger.prototype.initialize.call(this)},onTrigger:function(a){if(null!=
this.options.context&&null!=this.options.action){var c=this.resolveModelExpression(this.options.context,this.options.action,{evalVal:!1});b.isArray(c)&&(c=b.last(c));var d=this.options.data;void 0!==this.options.data&&b.has(d,"path")&&(a.data=this.resolveModelExpressionValue(this.options.context,d));c(a)}}});d.extend(c.ActionTrigger.prototype,c.ModelNavMixins);var q=function(a){this.options=d.extend({},a);0<arguments.length&&(b.defaults(this.options,this.defaults),a.el&&this.setEl(a.el));this.initialize()};
q.extend=d.extendClass;d.extend(q.prototype,{defaults:{block:null,context:null,el:null},initialize:function(){this.childInstances=[];b.bindAll(this,"render")},render:function(){},renderInternal:function(a,c,d){var f=this;a=a?a:this.options.block;var k=g(c);b.each(a.childNodes,function(a,b){var c=a.createInstance(k,d);f.childInstances.push(c);c instanceof q&&c.render()})},setEl:function(a){this.el=a;this.$el=g(a)},resolveElement:function(a,c){var d=a;b.each(c,function(a){d=d.contents().eq(a)});return d},
clear:function(){b.each(this.childInstances,function(a){a.dispose&&a.dispose()});this.childInstances=[];this.$el.empty()},dispose:function(){this.clear()},createContext:function(a,d){var f;f=null!=d?this.options.context.clone():new c.Model;b.each(a,function(a,c,d){f.set(c,a);b.isUndefined(a)||b.isNull(a)||f.createField(c,{type:a.constructor})});return f}});d.extend(q.prototype,c.ModelNavMixins);var H=q.extend({initialize:function(){q.prototype.initialize.apply(this);b.bindAll(this,"render")},render:function(){var a=
this.options.block;this.setEl(a.$el.clone());var b=this.createContext(this.options.context);this.renderInternal(a,this.$el,b);this.$el.removeClass("xt-template")}}),F=q.extend({initialize:function(){q.prototype.initialize.apply(this);b.bindAll(this,"modelChanged","render");var a=this.options.block.model;this.bindModelExpression(this.options.context,a,this.modelChanged);this.model=this.resolveModelExpressionValue(this.options.context,a)},modelChanged:function(){var a=t.options.block.model;t.unbindModelPath(t.options.context,
a,t.modelChanged);t.bindModelExpression(t.options.context,a,t.modelChanged);t.model=t.resolveModelExpressionValue(t.options.context,a)},render:function(){var a=this.options.block;this.clear();a=a.template;(b.isUndefined(a)||b.isNull(a))&&this.model instanceof c.ViewModel?a=this.model.render():(b.isObject(a)&&(a=this.resolveModelExpressionValue(this.options.context,a)),d.template(a)("destroy",this.$el),a=d.template(a)(this.model));this.$el.replaceWith(a);this.setEl(a)},dispose:function(){var a=this.options.block;
this.clear();a=a.template;(b.isUndefined(a)||b.isNull(a))&&this.model instanceof c.ViewModel&&this.model.dispose()}}),D=q.extend({initialize:function(){var a=this,c=a.options.block;a.current=null;for(var d=a.$el.next();0<d.filter("[data-xt-else-if]").length;)a.$el=a.$el.add(d),d=d.next();0<d.filter("[data-xt-else]").length&&(a.$el=a.$el.add(d));q.prototype.initialize.apply(a);b.bindAll(a,"render");this.branches=[];b.each(c.branches,function(c,d){var e={};e.callback=b.bind(a.modelChanged,a,d);e.value=
a.resolveModelExpressionValue(a.options.context,c.expression);null===a.current&&e.value&&(a.current=d);a.bindModelExpression(a.options.context,c.expression,e.callback);a.branches.push(e)})},modelChanged:function(a){var b=this.options.block,c=this.branches[a],d=c.value;c.value=this.resolveModelExpressionValue(this.options.context,b.branches[a].expression);if((null===this.current||a<=this.current)&&c.value!=d){a=null;for(c=0;c<this.branches.length;c++)if(this.branches[c].value){a=c;break}null===a&&
null!==b.defaultBranch&&(a=this.branches.length);this.current=a;this.render()}},render:function(){var a=this.options.block,c=null!==this.current&&this.current<this.branches.length?a.branches[this.current]:a.defaultBranch;this.clear();var d=null;c?(d=c.$el.clone(),d.removeAttr("data-xt-if"),this.renderInternal(c,d,this.options.context)):d=document.createTextNode("");for(var f=0;f<this.branches.length-1;f++)d=d.add(document.createTextNode(""));null!==a.defaultBranch&&(d=d.add(document.createTextNode("")));
this.$el.eq(0).prev().length?d.insertBefore(this.$el.eq(0)):this.$el.eq(0).parent().prepend(d);this.$el.remove();this.setEl(d);c&&b.has(c,"onrender")&&(a=this.resolveModelExpression(this.options.context,c.onrender),b.isArray(a)&&0<a.length&&(a=b.last(a),a(d)))}}),y=q.extend({initialize:function(){q.prototype.initialize.apply(this);var a=this.options.block.expression;b.bindAll(this,"render","modelChanged");this.bindModelExpression(this.options.context,a,this.modelChanged);this.value=this.resolveModelExpressionValue(this.options.context,
a)},modelChanged:function(a){var b=this.options.block.expression,c=this.resolveModelExpressionValue(this.options.context,b);a=this.value!=c||"add"===a||"remove"===a;this.value=c;a&&(this.value=this.resolveModelExpressionValue(this.options.context,b),this.render())},render:function(){var a=this,d=a.options.block;a.clear();if(a.value&&0<a.value.length){var f=d.iterator,k=b.has(d,"indexer")?d.indexer:void 0;d.$el.clone().children();a.$el.removeAttr("data-xt-foreach");a.$el.removeAttr("data-xt-iterator");
var l=function(b,c,l){l={};void 0!==k&&(l[k]=c);l[f]=b;b=a.createContext(l,a.options.context);c=g(d.el).clone();a.renderInternal(a.options.block,c,b);a.$el.append(c.children())};a.value instanceof c.Collection?a.value.forEach(l):b.each(a.value,l)}b.has(d,"onrender")&&(l=a.resolveModelExpression(a.options.context,d.onrender),b.isArray(l)&&0<l.length&&(l=b.last(l),l($next)))}}),E={};c.Template=function(a,b){this.block=a;this.context=b;this.tmplID=Math.floor(1E8*Math.random());E[this.tmplID]=this};d.extend(c.Template.prototype,
{render:function(){var a=new H({block:this.block,context:this.context});a.render();a=a.$el;a.data("template-id",this.tmplID);return a.children()},dispose:function(){}});c.Template.compile=function(){var a;if(2<arguments.length)throw"Invalid arguments";a=arguments[0]instanceof g?arguments[0]:g(arguments[0]);a=g("<div></div>").append(a);var e=(new c.templateParser).parse(a);return 2===arguments.length&&!0===arguments[1]?e:function(a,f,k){if(!b.isString(a)){k=f;var l={model:a};k&&k.context&&d.extend(l,
k.context);return(new c.Template(e,l)).render()}a=arguments[0];if(!b.isString(a))throw"Invalid argument (1), String expected";switch(a){case "destroy":if(2!==arguments.length)throw"Invalid number of arguments";l=arguments[1];if(!(l instanceof g))throw"Invalid argument (2), jQuery expected";l.data("template-id")&&E[l.data("template-id")].dispose()}}};"undefined"!==typeof test&&(c.templateInstances=E);return c});
